<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³° | å·ä¸€åœŸçš„åšå®¢è§†ç•Œ</title><meta name="author" content="yiTuChuan"><meta name="copyright" content="yiTuChuan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ·±å…¥è®²è§£ ES6+ çš„æ ¸å¿ƒç‰¹æ€§ï¼ŒåŒ…æ‹¬ Set&#x2F;Map é›†åˆã€Symbol ç±»å‹ï¼ˆç•¥ï¼‰ã€Proxy&#x2F;Reflect å…ƒç¼–ç¨‹ã€Iterator è¿­ä»£å™¨ã€Generator ç”Ÿæˆå™¨ã€ArrayBuffer äºŒè¿›åˆ¶æ•°ç»„ï¼ˆç•¥ï¼‰ç­‰é«˜çº§æ¦‚å¿µã€‚é€šè¿‡ä¸°å¯Œçš„ä»£ç ç¤ºä¾‹å’ŒåŸç†è§£æï¼Œå¸®åŠ©è¯»è€…æŒæ¡ç°ä»£ JavaScript çš„é‡è¦è¯­è¨€ç‰¹æ€§ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³°">
<meta property="og:url" content="https://zhengzehua.top/2025/02/08/ES6%E6%95%99%E7%A8%8B@%E9%98%AE%E4%B8%80%E5%B3%B0/index.html">
<meta property="og:site_name" content="å·ä¸€åœŸçš„åšå®¢è§†ç•Œ">
<meta property="og:description" content="æ·±å…¥è®²è§£ ES6+ çš„æ ¸å¿ƒç‰¹æ€§ï¼ŒåŒ…æ‹¬ Set&#x2F;Map é›†åˆã€Symbol ç±»å‹ï¼ˆç•¥ï¼‰ã€Proxy&#x2F;Reflect å…ƒç¼–ç¨‹ã€Iterator è¿­ä»£å™¨ã€Generator ç”Ÿæˆå™¨ã€ArrayBuffer äºŒè¿›åˆ¶æ•°ç»„ï¼ˆç•¥ï¼‰ç­‰é«˜çº§æ¦‚å¿µã€‚é€šè¿‡ä¸°å¯Œçš„ä»£ç ç¤ºä¾‹å’ŒåŸç†è§£æï¼Œå¸®åŠ©è¯»è€…æŒæ¡ç°ä»£ JavaScript çš„é‡è¦è¯­è¨€ç‰¹æ€§ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhengzehua.top/images/butterfly_avatar_img.svg">
<meta property="article:published_time" content="2025-02-08T10:21:02.000Z">
<meta property="article:modified_time" content="2025-06-05T07:36:03.275Z">
<meta property="article:author" content="yiTuChuan">
<meta property="article:tag" content="å‰ç«¯å­¦ä¹ ,å‰ç«¯å¼€å‘,Webå¼€å‘,æŠ€æœ¯åˆ†äº«,å­¦ä¹ æ„Ÿæ‚Ÿ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhengzehua.top/images/butterfly_avatar_img.svg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³°",
  "url": "https://zhengzehua.top/2025/02/08/ES6%E6%95%99%E7%A8%8B@%E9%98%AE%E4%B8%80%E5%B3%B0/",
  "image": "https://zhengzehua.top/images/butterfly_avatar_img.svg",
  "datePublished": "2025-02-08T10:21:02.000Z",
  "dateModified": "2025-06-05T07:36:03.275Z",
  "author": [
    {
      "@type": "Person",
      "name": "yiTuChuan",
      "url": "https://github.com/Nasir1423"
    }
  ]
}</script><link rel="shortcut icon" href="/images/butterfly_favicon.svg"><link rel="canonical" href="https://zhengzehua.top/2025/02/08/ES6%E6%95%99%E7%A8%8B@%E9%98%AE%E4%B8%80%E5%B3%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="VS0CYuuxqYH1AjmSVIi39UiBz0ubcCCtUtHMiSsRQXA"/><meta name="msvalidate.01" content="3C21ED06CE83FA63D0A6E0ADE00F1DEE"/><link rel="stylesheet" href="/css/index.css?v=5.4.0-b2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-JRLJPHP21V"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-JRLJPHP21V')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-JRLJPHP21V', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³°',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/styles/minimal.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/butterfly_avatar_img.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å®ç”¨ç«™ç‚¹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(to top, #2980b9, #6dd5fa, #ffffff);;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/butterfly_nav_logo.svg" alt="Logo"><span class="site-name">å·ä¸€åœŸçš„åšå®¢è§†ç•Œ</span></a><a class="nav-page-title" href="/"><span class="site-name">ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³°</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å®ç”¨ç«™ç‚¹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ğŸ“–ES6 æ•™ç¨‹ @é˜®ä¸€å³°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-02-08T10:21:02.000Z" title="å‘è¡¨äº 2025-02-08 18:21:02">2025-02-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-06-05T07:36:03.275Z" title="æ›´æ–°äº 2025-06-05 15:36:03">2025-06-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/">å‰ç«¯çŸ¥è¯†</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/ES6/">ES6</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">13.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>53åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Set-Map">Set &amp; Map</h2>
<h3 id="1-Set">1. Set</h3>
<ol>
<li>
<p>è§£é‡Šï¼šç±»ä¼¼æ•°ç»„ï¼Œä½†æ˜¯<strong>æˆå‘˜å€¼å”¯ä¸€</strong>çš„æ•°æ®ç»“æ„ã€‚æˆå‘˜å€¼é‡å¤åˆ¤æ–­çš„ç®—æ³•ä¸º Same-value equalityï¼Œç±»ä¼¼ <code>===</code> è¿ç®—ç¬¦ã€‚</p>
<blockquote>
<p>æ³¨ï¼šSame-value equality è®¤ä¸º NaN ç­‰äºè‡ªèº«ï¼Œä½†æ˜¯ <code>===</code> è®¤ä¸º NaN ä¸ç­‰äºè‡ªèº«ã€‚</p>
</blockquote>
</li>
<li>
<p>åˆå§‹åŒ–</p>
<ul>
<li>
<p>æ–¹æ³•ä¸€ï¼šåˆ›å»ºç©º <code>Set</code>ï¼Œä½¿ç”¨ <code>.add()</code> æ·»åŠ æˆå‘˜</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">x</span> =&gt;</span> set.<span class="title function_">add</span>(x));</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ–¹æ³•äºŒï¼šæ¥å—æ•°ç»„æˆ–å®ç°äº† Iterable æ¥å£çš„æ•°æ®ç»“æ„ä½œä¸ºå‚æ•°ï¼Œåˆ›å»º <code>Set</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> items = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å®ä¾‹å±æ€§å’Œæ–¹æ³•</p>
<ul>
<li>
<p>å±æ€§</p>
<ul>
<li>
<p><code>.constructor</code> æ„é€ å‡½æ•°ï¼Œå³ Set å‡½æ•°ã€‚</p>
</li>
<li>
<p><code>.size</code> Set å®ä¾‹çš„æˆå‘˜æ€»æ•°ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ“ä½œæ–¹æ³•</p>
<ul>
<li>
<p><code>.add(value): Set</code> æ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å› Set å®ä¾‹æœ¬èº«ï¼Œå› æ­¤å¯ä»¥é“¾å¼è°ƒç”¨ã€‚</p>
</li>
<li>
<p><code>.delete(value): boolean</code> åˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸã€‚</p>
</li>
<li>
<p><code>.has(value): boolean</code> è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å€¼æ˜¯å¦ä¸º Set å®ä¾‹çš„æˆå‘˜ã€‚</p>
</li>
<li>
<p><code>.clear(): void</code> æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</p>
</li>
</ul>
</li>
<li>
<p>éå†æ–¹æ³•ï¼šSet çš„<strong>éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº</strong></p>
<blockquote>
<p>æ³¨-1ï¼š<code>.keys()</code> æ–¹æ³•å’Œ <code>.values()</code> æ–¹æ³•çš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ï¼Œå› ä¸º Set çš„é”®åå’Œé”®å€¼æ˜¯ç›¸åŒçš„ã€‚</p>
<p>æ³¨-2ï¼šéå†å™¨å¯ä»¥ä½¿ç”¨ <code>for...of</code> éå†ã€‚</p>
<p>æ³¨-3ï¼šSet å®ä¾‹é»˜è®¤å¯ä»¥éå†ï¼Œå…¶é»˜è®¤éå†å™¨ç”Ÿæˆå‡½æ•°å³å…¶ <code>.values()</code> æ–¹æ³•ã€‚</p>
<p>æ³¨-4ï¼šå¯ä»¥å¯¹ <code>.key()</code>ã€<code>.values()</code>ã€<code>.entries()</code> è¿”å›çš„éå†å™¨ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ <code>...</code>ï¼Œå¿«é€Ÿè½¬æ¢ä¸ºæ•°ç»„ã€‚</p>
</blockquote>
<ul>
<li><code>.keys()</code> è¿”å›é”®åçš„éå†å™¨ã€‚</li>
<li><code>.values()</code> è¿”å›é”®å€¼çš„éå†å™¨ã€‚</li>
<li><code>.entries()</code> è¿”å›é”®å€¼å¯¹çš„éå†å™¨ã€‚</li>
<li><code>.forEach((value, key, set) =&gt; &#123;&#125;, thisArg)</code> ä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>åº”ç”¨åœºæ™¯ï¼šæ•°ç»„å»é‡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>];</span><br><span class="line">array = [...<span class="keyword">new</span> <span class="title class_">Set</span>(array)]; <span class="comment">// æ–¹æ³•ä¸€ï¼ˆ...æ‰©å±•è¿ç®—ç¬¦å†…éƒ¨ä½¿ç”¨äº† for...of å¾ªç¯éå† Set ç»“æ„ï¼‰</span></span><br><span class="line">array = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="keyword">new</span> <span class="title class_">Set</span>(array)); <span class="comment">// æ–¹æ³•äºŒ</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-WeakSet">2. WeakSet</h3>
<ol>
<li>
<p>è§£é‡Šï¼šä¸ Set ç±»ä¼¼ï¼Œä½†æ˜¯<strong>æˆå‘˜ç±»å‹åªèƒ½æ˜¯å¯¹è±¡</strong>ï¼Œä¸”ä¸º<strong>å¼±å¼•ç”¨</strong>ï¼Œå³åªè¦å…¶ä»–å¯¹è±¡éƒ½ä¸å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆ GC ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œè€Œä¸è€ƒè™‘è¯¥å¯¹è±¡æ˜¯å¦è¿˜å­˜åœ¨äº WeakSet ä¹‹ä¸­ã€‚ç”±äº WeakSet å†…éƒ¨æœ‰å¤šå°‘ä¸ªæˆå‘˜ï¼Œå–å†³äº GC æœ‰æ²¡æœ‰è¿è¡Œï¼Œè¿è¡Œå‰åå¾ˆå¯èƒ½æˆå‘˜ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œ GC ä½•æ—¶è¿è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ ES6 è§„å®š WeakSet <strong>ä¸å¯éå†</strong>ã€‚</p>
</li>
<li>
<p>ä¸ Set çš„åŒºåˆ«</p>
<ul>
<li>æ²¡æœ‰ <code>.size</code> å±æ€§ã€‚</li>
<li>æ²¡æœ‰ <code>.clear()</code> æ–¹æ³•ã€‚</li>
<li>æ²¡æœ‰ <code>.keys()</code>ã€<code>.values()</code> ç­‰éå†æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>
<p>åº”ç”¨åœºæ™¯</p>
<ul>
<li>
<p>DOM èŠ‚ç‚¹çš„å­˜å‚¨ã€‚å½“ DOM èŠ‚ç‚¹ä»æ–‡æ¡£ç§»é™¤æ—¶ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚</p>
</li>
<li>
<p>ç¡®ä¿å®ä¾‹æ–¹æ³•åªèƒ½åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foos = <span class="keyword">new</span> <span class="title class_">WeakSet</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        foos.<span class="title function_">add</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">method</span> () &#123;</span><br><span class="line">        <span class="keyword">if</span> (!foos.<span class="title function_">has</span>(<span class="variable language_">this</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Foo.prototype.method åªèƒ½åœ¨ Foo çš„å®ä¾‹ä¸Šè°ƒç”¨ï¼&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="3-Map">3. Map</h3>
<ol>
<li>
<p>è§£é‡Šï¼šç±»ä¼¼å¯¹è±¡ï¼Œä½†åŠ å¼ºç‰ˆï¼Œ<strong>å…è®¸ä»»æ„ç±»å‹çš„å€¼ä½œä¸ºé”®</strong>çš„æ•°æ®ç»“æ„ã€‚</p>
<blockquote>
<p>æ³¨ï¼šå¯¹äº numberã€stringã€boolean ç±»å‹çš„é”®ï¼ŒMap éœ€è¦é€šè¿‡ä¸¥æ ¼ç›¸ç­‰åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªé”®ï¼›true å’Œ â€˜trueâ€™ è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„é”®ï¼›undefined å’Œ null è¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„é”®ï¼›NaN åŠå…¶è‡ªèº«è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„é”®ã€‚</p>
</blockquote>
</li>
<li>
<p>åˆå§‹åŒ–</p>
<ul>
<li>
<p>æ–¹æ³•ä¸€ï¼šåˆ›å»ºç©º <code>Map</code>ï¼Œä½¿ç”¨ <code>.set(key, value)</code> æ·»åŠ é”®å€¼å¯¹</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map1 = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span> &#125;;</span><br><span class="line">map1.<span class="title function_">set</span>(person, <span class="string">`<span class="subst">$&#123;person.name&#125;</span>-<span class="subst">$&#123;person.age&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ–¹æ³•äºŒï¼šæ¥å—æ•°ç»„ï¼ˆæˆå‘˜ä¸ºé•¿åº¦ä¸º 2 çš„æ•°ç»„ï¼‰æˆ–å®ç°äº† Iterable æ¥å£çš„æ•°æ®ç»“æ„ï¼ˆæˆå‘˜ä¸ºé•¿åº¦ä¸º 2 çš„æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°ï¼Œåˆ›å»º <code>Map</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;å¼ ä¸‰&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;age&#x27;</span>, <span class="number">19</span>]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å®ä¾‹å±æ€§å’Œæ–¹æ³•</p>
<ul>
<li>
<p>å±æ€§</p>
<ul>
<li><code>.constructor</code> æ„é€ å‡½æ•°ï¼Œå³ Map å‡½æ•°ã€‚</li>
<li><code>.size</code> æ€§è¿”å› Map ç»“æ„çš„æˆå‘˜æ€»æ•°</li>
</ul>
</li>
<li>
<p>æ“ä½œæ–¹æ³•</p>
<ul>
<li><code>.set(key, value): Map</code> è®¾ç½®é”®å key å¯¹åº”çš„é”®å€¼ä¸º value ï¼Œç„¶åè¿”å›æ•´ä¸ª Map ç»“æ„ï¼Œå› æ­¤å¯ä»¥é“¾å¼è°ƒç”¨ã€‚å¦‚æœ key å·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®ã€‚</li>
<li><code>.get(key): any</code> æ³•è¯»å– key å¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ° key ï¼Œè¿”å› undefinedã€‚</li>
<li><code>.has(key): boolean</code> è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨å½“å‰ Map å¯¹è±¡ä¹‹ä¸­ã€‚</li>
<li><code>.delete(key): boolean</code> åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å› trueã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å› falseã€‚</li>
<li><code>.clear(): void</code> æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li>
</ul>
</li>
<li>
<p>éå†æ–¹æ³•ï¼šMap çš„<strong>éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº</strong></p>
<blockquote>
<p>æ³¨-1ï¼šéå†å™¨å¯ä»¥ä½¿ç”¨ <code>for...of</code> éå†ã€‚</p>
<p>æ³¨-2ï¼šMap å®ä¾‹é»˜è®¤å¯ä»¥éå†ï¼Œå…¶é»˜è®¤éå†å™¨ç”Ÿæˆå‡½æ•°å³å…¶ <code>.entries()</code> æ–¹æ³•ã€‚</p>
<p>æ³¨-3ï¼šå¯ä»¥å¯¹ <code>.key()</code>ã€<code>.values()</code>ã€<code>.entries()</code> è¿”å›çš„éå†å™¨ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ <code>...</code>ï¼Œå¿«é€Ÿè½¬æ¢ä¸ºæ•°ç»„ã€‚</p>
</blockquote>
<ul>
<li><code>.keys()</code> è¿”å›é”®åçš„éå†å™¨ã€‚</li>
<li><code>.values()</code> è¿”å›é”®å€¼çš„éå†å™¨ã€‚</li>
<li><code>.entries()</code> è¿”å›é”®å€¼å¯¹çš„éå†å™¨ã€‚</li>
<li><code>.forEach((value, key, map) =&gt; &#123;&#125;, thisArg)</code> ä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="4-WeakMap">4. WeakMap</h3>
<ol>
<li>
<p>è§£é‡Šï¼šä¸ Map ç±»ä¼¼ï¼Œä½†æ˜¯<strong>é”®çš„ç±»å‹åªèƒ½æ˜¯å¯¹è±¡</strong>ï¼ˆnull é™¤å¤–ï¼‰ï¼Œä¸”ä¸º<strong>å¼±å¼•ç”¨</strong>ï¼Œå³åªè¦æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å…¶ä»–å¼•ç”¨éƒ½è¢«æ¸…é™¤ï¼ŒGC å°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼ŒWeakMap é‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚</p>
<blockquote>
<p>æ³¨ï¼šWeakMap çš„é”®å€¼ä¸º<strong>æ­£å¸¸å¼•ç”¨</strong>ï¼Œä¸ä¼šå› ä¸ºé”®åè¢«å›æ”¶è€Œè¢«æ¶ˆé™¤ã€‚</p>
</blockquote>
</li>
<li>
<p>ä¸ Map çš„åŒºåˆ«</p>
<ul>
<li>æ²¡æœ‰ <code>.size</code> å±æ€§ã€‚</li>
<li>æ²¡æœ‰ <code>.clear()</code> æ–¹æ³•ã€‚</li>
<li>æ²¡æœ‰ <code>.keys()</code>ã€<code>.values()</code> ç­‰éå†æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>
<p>åº”ç”¨åœºæ™¯</p>
<ul>
<li>
<p>ä¸º DOM èŠ‚ç‚¹é™„åŠ æè¿°ä¿¡æ¯ã€‚å½“ DOM èŠ‚ç‚¹ä»æ–‡æ¡£ç§»é™¤æ—¶ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;logo&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> myWeakmap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">myWeakmap.<span class="title function_">set</span>(myElement, &#123;<span class="attr">timesClicked</span>: <span class="number">0</span>&#125;);</span><br><span class="line">myElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> logoData = myWeakmap.<span class="title function_">get</span>(myElement);</span><br><span class="line">    logoData.<span class="property">timesClicked</span>++;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>éƒ¨ç½²ç§æœ‰å±æ€§ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _counter = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> _action = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Countdown</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">counter, action</span>) &#123;</span><br><span class="line">        _counter.<span class="title function_">set</span>(<span class="variable language_">this</span>, counter);</span><br><span class="line">        _action.<span class="title function_">set</span>(<span class="variable language_">this</span>, action);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">dec</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> counter = _counter.<span class="title function_">get</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (counter &lt; <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        counter--;</span><br><span class="line">        _counter.<span class="title function_">set</span>(<span class="variable language_">this</span>, counter);</span><br><span class="line">        <span class="keyword">if</span> (counter === <span class="number">0</span>) &#123;</span><br><span class="line">            _action.<span class="title function_">get</span>(<span class="variable language_">this</span>)();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> <span class="title class_">Countdown</span>(<span class="number">2</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DONE&#x27;</span>));</span><br><span class="line">c.<span class="title function_">dec</span>()</span><br><span class="line">c.<span class="title function_">dec</span>()</span><br><span class="line"><span class="comment">// DONE</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="Symbol">Symbol</h2>
<p>More in <a target="_blank" rel="noopener" href="https://netmarket.oss.aliyuncs.com/35cdb5c1-9e70-4562-a245-2664416d784b.pdf">é˜®ä¸€å³° ES6ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</a></p>
<h2 id="Reflect">Reflect</h2>
<h3 id="1-ç®€è¦æ¦‚è¿°">1. ç®€è¦æ¦‚è¿°</h3>
<ol>
<li>
<p>è§£é‡Šï¼šReflect æ˜¯ ES6 å¼•å…¥çš„ä¸€ä¸ªæ–°çš„<strong>å…¨å±€å¯¹è±¡</strong>ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç”¨äº<strong>æ“ä½œå¯¹è±¡</strong>çš„æ–¹æ³•ã€‚</p>
</li>
<li>
<p>è®¾è®¡ç›®çš„</p>
<ul>
<li>
<p>å°†ä¸€äº›æ˜æ˜¾å±äº<strong>è¯­è¨€å†…éƒ¨</strong>çš„æ–¹æ³•ï¼ˆå¦‚ <code>Object.defineProperty</code>ï¼‰æ”¾åˆ° Reflect å¯¹è±¡ä¸Šã€‚</p>
</li>
<li>
<p>ä¿®æ”¹æŸäº› Object æ–¹æ³•çš„è¿”å›ç»“æœï¼Œä½¿å…¶æ›´<strong>åˆç†</strong>ã€‚å¦‚ <code>Object.defineProperty(obj, name, desc)</code> åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ ä¸ªé”™è¯¯ï¼Œè€Œ <code>Reflect.defineProperty(obj, name, desc)</code> åˆ™ä¼šè¿”å› <code>false</code>ã€‚</p>
</li>
<li>
<p>è®© Object æ“ä½œéƒ½å˜æˆ<strong>å‡½æ•°è¡Œä¸º</strong>ã€‚å¦‚ <code>name in obj</code> å’Œ <code>delete obj[name]</code> ï¼Œè€Œ <code>Reflect.has(obj, name)</code> å’Œ <code>Reflect.deleteProperty(obj, name)</code> è®©å®ƒä»¬å˜æˆäº†å‡½æ•°è¡Œä¸ºã€‚</p>
</li>
<li>
<p>ä¿æŒä¸ Proxy å¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚Proxy å¯¹è±¡ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œè€Œ Reflect å¯¹è±¡æ‰§è¡Œé»˜è®¤è¡Œä¸ºã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="2-é™æ€æ–¹æ³•">2. é™æ€æ–¹æ³•</h3>
<ol>
<li>
<p><code>Reflect.get(target, name[, receiver])</code></p>
<ul>
<li>
<p>å†å²æ–¹æ³• <code>target[name]</code></p>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>æŸ¥æ‰¾å¹¶è¿”å› <code>target</code> å¯¹è±¡çš„ <code>name</code> å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™è¿”å› <code>undefined</code>ã€‚</li>
<li><code>receiver</code> ç”¨äºæŒ‡å®š <code>target</code> å¯¹è±¡ä¸­çš„ <code>getter</code> å±æ€§çš„ <code>this</code>ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Reflect.get</code> æ–¹æ³•ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.set(target, name, value[, receiver])</code></p>
</li>
</ol>
<ul>
<li>å†å²æ–¹æ³• <code>target[name] = value</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è®¾ç½® <code>target</code> å¯¹è±¡çš„ <code>name</code> å±æ€§ç­‰äº <code>value</code>ã€‚</li>
<li><code>receiver</code> ç”¨äºæŒ‡å®š <code>target</code> å¯¹è±¡ä¸­çš„ <code>setter</code> å±æ€§çš„ <code>this</code>ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Reflect.set</code> ä¼šæŠ¥é”™ã€‚</li>
<li><code>Reflect.set</code>ï¼ˆéœ€è¦ä½¿ç”¨ <code>receiver</code> å‚æ•°ï¼‰ä¼šè§¦å‘ <code>Proxy.defineProperty</code> æ‹¦æˆªã€‚</li>
</ul>
</li>
</ul>
<ol start="3">
<li><code>Reflect.has(obj, name): boolean</code></li>
</ol>
<ul>
<li>å†å²æ–¹æ³• <code>name in obj</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>æ£€æŸ¥æŒ‡å®šçš„å±æ€§æ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„<strong>å¯¹è±¡æˆ–å…¶åŸå‹é“¾</strong>ä¸­ï¼ŒåŒ…æ‹¬<strong>ä¸å¯æšä¸¾</strong>å±æ€§ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Reflect.has</code> å’Œ <code>in</code> è¿ç®—ç¬¦éƒ½ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<ol start="4">
<li><code>Reflect.deleteProperty(target, name): boolean</code></li>
</ol>
<ul>
<li>å†å²æ–¹æ³• <code>delete obj[name]</code></li>
<li>ä½¿ç”¨è¯´æ˜ï¼šåˆ é™¤å¯¹è±¡çš„å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœåˆ é™¤æˆåŠŸï¼Œæˆ–è€…è¢«åˆ é™¤çš„å±æ€§ä¸å­˜åœ¨ï¼Œè¿”å› <code>true</code> ï¼› åˆ é™¤å¤±è´¥ï¼Œè¢«åˆ é™¤çš„å±æ€§ä¾ç„¶å­˜åœ¨ï¼Œè¿”å› <code>false</code>ã€‚</li>
</ul>
<ol start="5">
<li><code>Reflect.construct(target, args)</code></li>
</ol>
<ul>
<li>å†å²æ–¹æ³• <code>new target(...args)</code></li>
<li>ä½¿ç”¨è¯´æ˜ï¼šæä¾›äº†ä¸€ç§ä¸ä½¿ç”¨ <code>new</code> ï¼Œæ¥è°ƒç”¨æ„é€ å‡½æ•°çš„æ–¹æ³•ã€‚</li>
</ul>
<ol start="6">
<li><code>Reflect.getPrototypeOf(obj)</code></li>
</ol>
<ul>
<li>å†å²æ–¹æ³•  <code>Object.getPrototypeOf(obj)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è¯»å–å¯¹è±¡çš„ <code>__proto__</code> å±æ€§ã€‚</li>
<li><code>Reflect.getPrototypeOf</code> å’Œ <code>Object.getPrototypeOf</code> çš„ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Object.getPrototypeOf</code> ä¼šå°†è¿™ä¸ªå‚æ•°è½¬ä¸ºå¯¹è±¡ï¼Œç„¶åå†è¿è¡Œï¼Œ è€Œ <code>Reflect.getPrototypeOf</code> ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<ol start="7">
<li><code>Reflect.setPrototypeOf(obj, newProto)</code></li>
</ol>
<ul>
<li>å†å²æ–¹æ³• <code>Object.setPrototypeOf(obj, newProto)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è®¾ç½®å¯¹è±¡çš„ <code>__proto__</code> å±æ€§ï¼Œè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°å¯¹è±¡ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Object.setPrototypeOf</code> ä¼šè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°æœ¬èº«ï¼Œ è€Œ <code>Reflect.setPrototypeOf</code> ä¼šæŠ¥é”™ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•° æ˜¯ <code>undefined</code> æˆ– <code>null</code> ï¼Œ <code>Object.setPrototypeOf</code> å’Œ <code>Reflect.setPrototypeOf</code> éƒ½ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<ol start="8">
<li>
<p><code>Reflect.apply(func, thisArg, args)</code></p>
<ul>
<li>
<p>å†å²æ–¹æ³• <code>Function.prototype.apply.call(func, thisArg, args)</code></p>
<blockquote>
<p>æ³¨ï¼šè¿™é‡Œçš„ <code>args</code> ä¸ºä¼ é€’ç»™ <code>func</code> çš„å‚æ•°æ•°ç»„ã€‚</p>
</blockquote>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>ç»‘å®š <code>this</code>ï¼Œç„¶åæ‰§è¡Œç»™å®šå‡½æ•°ã€‚</li>
<li>å½“å‡½æ•°è‡ªå®šä¹‰äº† <code>apply</code> æ–¹æ³•æ—¶ï¼Œç›´æ¥è°ƒç”¨ <code>fn.apply(thisArg, args)</code> å°†æ— æ³•æ­£ç¡®æ‰§è¡Œå‡½æ•°å¹¶ç»‘å®š <code>this</code> å€¼ã€‚æ­¤æ—¶åº”ä½¿ç”¨ <code>Function.prototype.apply.call(func, thisArg, args)</code> æ¥ç¡®ä¿è°ƒç”¨åŸå§‹çš„ <code>apply</code> æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.defineProperty(target, propertyKey, attributes): boolean</code></p>
<ul>
<li>å†å²æ–¹æ³• <code>Object.defineProperty(target, propertyKey, attributes)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>ä¸ºå¯¹è±¡å®šä¹‰å±æ€§ã€‚</li>
<li>å¦‚æœ <code>Reflect.defineProperty</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
<li><code>Reflect.defineProperty</code> è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦å®šä¹‰æˆåŠŸã€‚<code>Object.defineProperty</code> åœ¨å¤±è´¥æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.getOwnPropertyDescriptor(target, propertyKey)</code></p>
<ul>
<li>å†å²æ–¹æ³• <code>Object.getOwnPropertyDescriptor(target, propertyKey)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>å¾—åˆ°æŒ‡å®šå±æ€§çš„æè¿°å¯¹è±¡ã€‚</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Object.getOwnPropertyDescriptor</code> ä¸æŠ¥é”™ï¼Œè¿”å› <code>undefined</code> ï¼Œè€Œ <code>Reflect.getOwnPropertyDescriptor</code> ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¡¨ç¤ºå‚æ•°éæ³•ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.isExtensible(target): boolean</code></p>
<ul>
<li>å†å²æ–¹æ³• <code>Object.isExtensible(target)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œ è¡¨ç¤ºå½“å‰å¯¹è±¡æ˜¯å¦å¯æ‰©å±•ï¼ˆå³æ˜¯å¦å¯ä»¥æ·»åŠ æ–°å±æ€§ï¼‰ã€‚</li>
<li>å¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ<code>Object.isExtensible</code> ä¼šè¿”å› <code>false</code> ï¼Œå› ä¸ºéå¯¹è±¡æœ¬æ¥å°±æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œè€Œ <code>Reflect.isExtensible</code> ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.preventExtensions(target): boolean</code></p>
<ul>
<li>å†å²æ–¹æ³• <code>Object.preventExtensions(target)</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è®©ä¸€ä¸ªå¯¹è±¡å˜ä¸ºä¸å¯æ‰©å±•ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ“ä½œæˆåŠŸã€‚</li>
<li>å¦‚æœå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼Œ <code>Object.preventExtensions</code> åœ¨ ES5 ç¯å¢ƒæŠ¥é”™ï¼Œåœ¨ ES6 ç¯å¢ƒè¿”å›ä¼ å…¥çš„å‚æ•°ï¼Œè€Œ <code>Reflect.preventExtensions</code> ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Reflect.ownKeys(target)</code></p>
<ul>
<li>å†å²æ–¹æ³• <code>Object.getOwnPropertyNames</code> + <code>Object.getOwnPropertySymbols</code></li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>è¿”å›å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="3-åº”ç”¨ï¼šè§‚å¯Ÿè€…æ¨¡å¼">3. åº”ç”¨ï¼šè§‚å¯Ÿè€…æ¨¡å¼</h3>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queuedObservers = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">observe</span> = (<span class="params">fn</span>) =&gt; queuedObservers.<span class="title function_">add</span>(fn);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">observable</span> = (<span class="params">obj</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123; set &#125;);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">target, key, value, receiver</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver);</span><br><span class="line">  queuedObservers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> <span class="title function_">observer</span>());</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = <span class="title function_">observable</span>(&#123; <span class="comment">// è§‚å¯Ÿç›®æ ‡</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">print</span>(<span class="params"></span>) &#123; <span class="comment">// è§‚å¯Ÿè€…</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;person.name&#125;</span>, <span class="subst">$&#123;person.age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">observe</span>(print); <span class="comment">// ä¸€æ—¦è§‚å¯Ÿç›®æ ‡æ”¹å˜ï¼Œè§‚å¯Ÿè€…å¯¹åº”çš„å‡½æ•°ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">person.<span class="property">name</span> = <span class="string">&quot;æå››&quot;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Proxy">Proxy</h2>
<h3 id="1-ç®€è¦æ¦‚è¿°-2">1. ç®€è¦æ¦‚è¿°</h3>
<ol>
<li>
<p>è§£é‡Šï¼šä¸ºç‰¹å®šå¯¹è±¡è®¾ç½®â€œæ‹¦æˆªâ€çš„<strong>æ•°æ®ç»“æ„</strong>ï¼Œå¯ä»¥å¯¹å¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®è¿›è¡Œè¿‡æ»¤æˆ–æ”¹å†™ã€‚</p>
</li>
<li>
<p>å®ä¾‹åŒ–</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šè¿™é‡Œçš„ <code>target</code> è¡¨ç¤ºè¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œ<code>handler</code> å‚æ•°ç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚å½“å¯¹ <code>proxy</code> å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œ<code>handler</code> ä¸­å®šä¹‰çš„æ‹¦æˆªè¡Œä¸ºæ‰ä¼šç”Ÿæ•ˆã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="2-æ‹¦æˆªæ“ä½œ">2. æ‹¦æˆªæ“ä½œ</h3>
<ol>
<li>
<p><code>get(target, propKey, receiver)</code></p>
<ul>
<li>
<p>è§£é‡Šï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œå¦‚ <code>proxy.foo</code>ã€<code>proxy['foo']</code>ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜ï¼šå¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰å’Œä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™è¯¥å±æ€§<strong>ä¸èƒ½è¢«ä»£ç†</strong>ï¼Œé€šè¿‡ Proxy å¯¹è±¡è®¿é—®è¯¥å±æ€§ä¼šæŠ¥é”™ã€‚</p>
</li>
<li>
<p>åº”ç”¨</p>
<ul>
<li>
<p>è®¿é—®ç›®æ ‡å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§æ—¶æŠ›é”™ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(person, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (property <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[property];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&quot;Property \&quot;&quot;</span> + property + <span class="string">&quot;\&quot; do</span></span><br><span class="line"><span class="string">                                     es not exist.&quot;</span>);</span><br><span class="line">                                     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å…è®¸è´Ÿæ•°ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createArray</span>(<span class="params">...elements</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> handler = &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params">target, propKey, receiver</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> index = <span class="title class_">Number</span>(propKey);</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                propKey = <span class="title class_">String</span>(target.<span class="property">length</span> + index);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, propKey, receiver);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> target = [];</span><br><span class="line">    target.<span class="title function_">push</span>(...elements);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®ç°å‡½æ•°åçš„é“¾å¼è°ƒç”¨ï¼Œå‰ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºåä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pipe = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> funcStack = [];</span><br><span class="line">        <span class="keyword">var</span> oproxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params">pipeObject, fnName</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fnName === <span class="string">&quot;get&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> funcStack.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">val, fn</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="title function_">fn</span>(val);</span><br><span class="line">                        &#125;, value);</span><br><span class="line">                    &#125;</span><br><span class="line">                    funcStack.<span class="title function_">push</span>(<span class="variable language_">window</span>[fnName]);</span><br><span class="line">                    <span class="keyword">return</span> oproxy;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> oproxy;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">double</span> = (<span class="params">n</span>) =&gt; n * <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">pow</span> = (<span class="params">n</span>) =&gt; n * n;</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">reverseInt</span> = (<span class="params">n</span>) =&gt; n.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>) | <span class="number">0</span>;</span><br><span class="line"><span class="title function_">pipe</span>(<span class="number">3</span>).<span class="property">double</span>.<span class="property">pow</span>.<span class="property">reverseInt</span>.<span class="property">get</span>; <span class="comment">// 63</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç”Ÿæˆ DOM ç»“æ„çš„é€šç”¨å‡½æ•°ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">attrs = &#123;&#125;, ...children</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(property);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(attrs)) &#123;</span><br><span class="line">                el.<span class="title function_">setAttribute</span>(prop, attrs[prop]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> child === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">                    child = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(child);</span><br><span class="line">                &#125;</span><br><span class="line">                el.<span class="title function_">appendChild</span>(child);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> el;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> el = dom.<span class="title function_">div</span>(&#123;&#125;,</span><br><span class="line">                   <span class="string">&#x27;Hello, my name is &#x27;</span>,</span><br><span class="line">                   dom.<span class="title function_">a</span>(&#123;<span class="attr">href</span>: <span class="string">&#x27;//example.com&#x27;</span>&#125;, <span class="string">&#x27;Mark&#x27;</span>),</span><br><span class="line">                   <span class="string">&#x27;. I like:&#x27;</span>,</span><br><span class="line">                   dom.<span class="title function_">ul</span>(&#123;&#125;,</span><br><span class="line">                          dom.<span class="title function_">li</span>(&#123;&#125;, <span class="string">&#x27;The web&#x27;</span>),</span><br><span class="line">                          dom.<span class="title function_">li</span>(&#123;&#125;, <span class="string">&#x27;Food&#x27;</span>),</span><br><span class="line">                          dom.<span class="title function_">li</span>(&#123;&#125;, <span class="string">&#x27;â€¦actually that\&#x27;s it&#x27;</span>)</span><br><span class="line">                         )</span><br><span class="line">                  );</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(el);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>set(target, propKey, value, receiver)</code></p>
<ul>
<li>
<p>è§£é‡Šï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œå¦‚ <code>proxy.foo = v</code>ã€ <code>proxy['foo'] = v</code>ã€‚</p>
</li>
<li>
<p>åº”ç”¨</p>
<ul>
<li>
<p>é™åˆ¶å¯¹è±¡å±æ€§çš„å–å€¼èŒƒå›´ï¼Œä¸æ»¡è¶³è¦æ±‚æ—¶æŠ¥é”™ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;age&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The age is not an integer&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value &gt; <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RangeError</span>(<span class="string">&#x27;The age seems invalid&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯¹äº age ä»¥å¤–çš„å±æ€§ï¼Œç›´æ¥ä¿å­˜</span></span><br><span class="line">        obj[prop] = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, validator);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–° DOMã€‚</p>
</li>
<li>
<p>ç¦æ­¢å†…éƒ¨å±æ€§ï¼ˆå¦‚ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„å­—æ®µï¼‰è¢«è¯»å–æˆ–ä¿®æ”¹ã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>has(target, propKey): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>propKey in proxy</code>ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å’ŒåŸå‹é“¾ä¸Šçš„å±æ€§ï¼‰çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>å¦‚æœåŸå¯¹è±¡ä¸å¯é…ç½®æˆ–è€…ç¦æ­¢æ‰©å±•ï¼Œè¿™æ—¶ <code>has</code> æ‹¦æˆªä¼šæŠ¥é”™ã€‚</li>
<li>è™½ç„¶ <code>for...in</code> å¾ªç¯ä¹Ÿç”¨åˆ°äº† <code>in</code> è¿ç®—ç¬¦ï¼Œä½†æ˜¯ <code>has</code> æ‹¦æˆª å¯¹ <code>for...in</code> å¾ªç¯ä¸ç”Ÿæ•ˆã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>deleteProperty(target, propKey): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>delete proxy[propKey]</code> çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å› <code>false</code> ï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢« <code>delete</code> å‘½ä»¤åˆ é™¤ã€‚</li>
</ul>
</li>
<li>
<p><code>ownKeys(target)</code></p>
<ul>
<li>
<p>è§£é‡Šï¼šæ‹¦æˆª <code>Object.getOwnPropertyNames(proxy)</code> ã€ <code>Object.getOwnPropertySymbols (proxy)</code> ã€ <code>Object.keys(proxy)</code> ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ–¹æ³•</th>
<th style="text-align:center">åŒ…å«å­—ç¬¦ä¸²å±æ€§</th>
<th style="text-align:center">åŒ…å« Symbol å±æ€§</th>
<th style="text-align:center">åŒ…å«ä¸å¯æšä¸¾å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Object.getOwnPropertyNames()</code></td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âŒ</td>
<td style="text-align:center">âœ…</td>
</tr>
<tr>
<td style="text-align:center"><code>Object.getOwnPropertySymbols()</code></td>
<td style="text-align:center">âŒ</td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âœ…</td>
</tr>
<tr>
<td style="text-align:center"><code>Object.keys()</code></td>
<td style="text-align:center">âœ…</td>
<td style="text-align:center">âŒ</td>
<td style="text-align:center">âŒ</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨ï¼šä½¿ç”¨ <code>Object.keys()</code> æ—¶ï¼Œ<code>Symbol</code> å±æ€§ã€ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œä»¥åŠä¸å¯æšä¸¾çš„å±æ€§ä¼šè¢«è¿‡æ»¤æ‰ã€‚</p>
</blockquote>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li><code>ownKeys</code> æ–¹æ³•è¿”å›çš„æ•°ç»„æˆå‘˜ï¼Œåªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚</li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«åŒ…å«ä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»è¢« <code>ownKeys</code> æ–¹æ³•è¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚</li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼ˆnon-extensitionï¼‰ï¼Œè¿™æ—¶ <code>ownKeys</code> æ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«åŸå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä¸”ä¸èƒ½åŒ…å«å¤šä½™çš„å±æ€§ï¼Œå¦åˆ™æŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>getOwnPropertyDescriptor(target, propKey)</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.getOwnPropertyDescriptor(proxy, propKey)</code>ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>
<p><code>defineProperty(target, propKey, propDesc): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.defineProperty(proxy, propKey, propDesc)</code> ã€ <code>Object.defineProperties(proxy, propDescs)</code>ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜
<ul>
<li>å¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œåˆ™ <code>defineProperty</code> ä¸èƒ½å¢åŠ ç›®æ ‡ å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡çš„æŸä¸ªå±æ€§ä¸å¯å†™ ï¼ˆwritableï¼‰æˆ–ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ï¼Œåˆ™ <code>defineProperty</code> æ–¹æ³•ä¸å¾—æ”¹å˜è¿™ä¸¤ä¸ªè®¾ç½®ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>preventExtensions(target): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.preventExtensions(proxy)</code>ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šåªæœ‰ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼ˆå³ <code>Object.isExtensible(proxy)</code> ä¸º <code>false</code>ï¼‰ï¼Œ<code>proxy.preventExtensions</code> æ‰èƒ½è¿”å› <code>true</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸è¦åœ¨ <code>proxy.preventExtensions</code> æ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨ä¸€ æ¬¡ <code>Object.preventExtensions</code> ã€‚</li>
</ul>
</li>
<li>
<p><code>getPrototypeOf(target)</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.getPrototypeOf(proxy)</code> ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šå¯æ‹¦æˆªçš„æƒ…å†µå…±åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æƒ…å†µï¼Œ
<ul>
<li><code>Object.prototype.__proto__</code></li>
<li><code>Object.prototype.isPrototypeOf()</code></li>
<li><code>Object.getPrototypeOf()</code></li>
<li><code>Reflect.getPrototypeOf()</code></li>
<li><code>instanceof</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>isExtensible(target): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.isExtensible(proxy)</code> ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šè¯¥æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡çš„ <code>isExtensible</code> å±æ€§ä¿æŒ ä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚å³ <code>Object.isExtensible(proxy) === Object.isExtensible(target)</code>ã€‚</li>
</ul>
</li>
<li>
<p><code>setPrototypeOf(target, proto): boolean</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª <code>Object.setPrototypeOf(proxy, proto)</code>ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šå¦‚æœç›®æ ‡å¯¹è±¡ä¸ å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œ<code>setPrototypeOf</code> æ–¹æ³•ä¸å¾—æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŸå‹ã€‚</li>
</ul>
</li>
<li>
<p><code>apply(target, object, args)</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ <code>proxy(...args)</code>ã€<code>proxy.call(object, ...args)</code>ã€<code>proxy.apply(...)</code>ã€‚</li>
</ul>
</li>
<li>
<p><code>construct(target, args)</code></p>
<ul>
<li>è§£é‡Šï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ <code>new proxy(...args)</code>ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼š<code>construct</code> æ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ol>
<h3 id="3-å¯å–æ¶ˆçš„-Proxy">3. å¯å–æ¶ˆçš„ Proxy</h3>
<ol>
<li>è§£é‡Šï¼š<code>Proxy.revocable()</code> æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ª<strong>å¯æ’¤é”€çš„ä»£ç†å¯¹è±¡</strong>ã€‚ä¸€æ—¦é€šè¿‡è°ƒç”¨ <code>revoke</code> å‡½æ•°æ’¤é”€äº†ä»£ç†ï¼Œè¯¥ä»£ç†å°†å˜å¾—ä¸å¯ç”¨ï¼Œä»»ä½•åç»­å¯¹å®ƒçš„æ“ä½œï¼ˆå¦‚è¯»å–ã€è®¾ç½®å±æ€§ï¼‰éƒ½ä¼šæŠ›å‡º <code>TypeError</code>ã€‚</li>
<li>ä½œç”¨ï¼šç²¾ç»†æ§åˆ¶ä»£ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>è¯­æ³•ï¼š<code>let &#123; proxy, revoke &#125; = Proxy.revocable(target, handler);</code>
<ul>
<li><code>proxy</code>ï¼šProxy å®ä¾‹ï¼Œå¯ä»¥åŸºäºæ‹¦æˆªè§„åˆ™ <code>handler</code>ï¼Œæ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡ <code>target</code> çš„è®¿é—®ã€‚</li>
<li><code>revoke</code>ï¼šä¸€ä¸ªä¸å¸¦å‚æ•°çš„å‡½æ•°ï¼Œç”¨äºå–æ¶ˆè¯¥ <code>proxy</code> å®ä¾‹ã€‚</li>
</ul>
</li>
</ol>
<h3 id="4-this-é—®é¢˜">4. this é—®é¢˜</h3>
<ol>
<li>
<p>è§£é‡Šï¼šå½“é€šè¿‡ Proxy å®ä¾‹è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œ<strong>æ–¹æ³•å†…éƒ¨çš„ <code>this</code> ä¼šæŒ‡å‘ Proxy å®ä¾‹æœ¬èº«</strong>ï¼Œè€Œä¸æ˜¯åŸå§‹çš„ç›®æ ‡å¯¹è±¡ã€‚è¿™å¯èƒ½å¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>å¦‚æœæ–¹æ³•å†…éƒ¨ä¾èµ– <code>this</code> æ¥è®¿é—®åŸå§‹å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•ï¼ˆå°¤å…¶æ˜¯é‚£äº›æœªè¢«ä»£ç†æ‹¦æˆªçš„å†…éƒ¨å±æ€§æˆ–åŸå‹é“¾ä¸Šçš„æ–¹æ³•ï¼‰ï¼Œå¯èƒ½ä¼šå‡ºç°éé¢„æœŸçš„è¡Œä¸ºæˆ–é”™è¯¯ã€‚</li>
<li>ç›´æ¥åœ¨ç›®æ ‡å¯¹è±¡ä¸Šè°ƒç”¨ç›¸åŒæ–¹æ³•æ—¶ï¼Œ<code>this</code> æŒ‡å‘ç›®æ ‡å¯¹è±¡ï¼Œè¡Œä¸ºå¯èƒ½ä¸é€šè¿‡ä»£ç†è°ƒç”¨æ—¶ä¸åŒã€‚</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123;</span><br><span class="line">    <span class="attr">m</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this === proxy:&#x27;</span>, <span class="variable language_">this</span> === proxy); <span class="comment">// æ£€æŸ¥ this æ˜¯å¦æŒ‡å‘ proxy</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this === target:&#x27;</span>, <span class="variable language_">this</span> === target); <span class="comment">// æ£€æŸ¥ this æ˜¯å¦æŒ‡å‘ target</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handler = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç›´æ¥è°ƒç”¨ target.m():&#x27;</span>);</span><br><span class="line">target.<span class="title function_">m</span>();</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">// this === proxy: false</span></span><br><span class="line"><span class="comment">// this === target: true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\né€šè¿‡ proxy.m() è°ƒç”¨:&#x27;</span>);</span><br><span class="line">proxy.<span class="title function_">m</span>();</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">// this === proxy: true</span></span><br><span class="line"><span class="comment">// this === target: false</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è§£å†³ï¼šä¸ºäº†ç¡®ä¿é€šè¿‡ä»£ç†è°ƒç”¨çš„æ–¹æ³•å†…éƒ¨çš„ <code>this</code> æ­£ç¡®æŒ‡å‘åŸå§‹çš„ç›®æ ‡å¯¹è±¡ï¼Œå¯ä»¥åœ¨ <code>get</code> æ‹¦æˆªå™¨ä¸­è¿›è¡Œå¤„ç†ï¼š</p>
<ul>
<li>å½“è®¿é—®çš„å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆæ–¹æ³•ï¼‰æ—¶ï¼Œ<strong>ä½¿ç”¨ <code>Function.prototype.bind()</code> å°†è¯¥æ–¹æ³•çš„ <code>this</code> ç»‘å®šåˆ°åŸå§‹çš„ <code>target</code> å¯¹è±¡ä¸Š</strong>ã€‚</li>
<li>å¯¹äºå…¶ä»–ç±»å‹çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <code>Reflect.get()</code> æ¥è·å–å±æ€§å€¼ï¼Œä»¥ä¿æŒé»˜è®¤è¡Œä¸ºã€‚</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, prop, receiver); <span class="comment">// ä½¿ç”¨ receiver æ¥æ­£ç¡®å¤„ç† getter ç­‰æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿åªç»‘å®šå®šä¹‰åœ¨ target è‡ªèº«æˆ–å…¶åŸå‹é“¾ä¸Šçš„å‡½æ•°</span></span><br><span class="line">            <span class="comment">// å¹¶ä¸”è¯¥å‡½æ•°ç¡®å®æ˜¯ target çš„ä¸€éƒ¨åˆ† (é¿å…ç»‘å®šä¸ç›¸å…³çš„å‡½æ•°)</span></span><br><span class="line">            <span class="keyword">return</span> value.<span class="title function_">bind</span>(target); <span class="comment">// å°† this ç»‘å®šåˆ°åŸå§‹ target</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> targetDate = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2025-10-20&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> proxyDate = <span class="keyword">new</span> <span class="title class_">Proxy</span>(targetDate, handler);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxyDate.<span class="title function_">getFullYear</span>()); <span class="comment">// è¾“å‡º: 2025 (this æ­£ç¡®æŒ‡å‘ targetDate)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> customTarget = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="title function_">getValue</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> proxyCustom = <span class="keyword">new</span> <span class="title class_">Proxy</span>(customTarget, handler);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(proxyCustom.<span class="title function_">getValue</span>()); <span class="comment">// è¾“å‡º: 42 (this æ­£ç¡®æŒ‡å‘ customTarget)</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-å¯¹è±¡å±æ€§æ£€æµ‹æ€»ç»“">5. å¯¹è±¡å±æ€§æ£€æµ‹æ€»ç»“</h3>
<p>ä¸ºäº†å®¢è§‚å‡†ç¡®åœ°å¯¹æ¯”ä¸€ç³»åˆ—æ£€æµ‹å¯¹è±¡å±æ€§çš„æ–¹æ³•ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹ç»´åº¦ â‘  <strong>è‡ªæœ‰å±æ€§ vs. ç»§æ‰¿å±æ€§</strong>ï¼ˆå³å±æ€§åœ¨å¯¹è±¡å®ä¾‹ä¸Šï¼Œè¿˜æ˜¯åœ¨åŸå‹é“¾ä¸Šï¼‰â‘¡ <strong>å¯æšä¸¾å±æ€§ vs. ä¸å¯æšä¸¾å±æ€§</strong>ï¼ˆå³å±æ€§æ˜¯å¦ä¼šå‡ºç°åœ¨ <code>for...in</code> æˆ– <code>Object.keys()</code> çš„ç»“æœä¸­ï¼‰â‘¢ <strong>å­—ç¬¦ä¸²å±æ€§ vs. Symbol å±æ€§</strong>ï¼ˆå³å±æ€§çš„é”®æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯ ES6 çš„ Symbolï¼‰â‘£ <strong>å®‰å…¨æ€§ä¸å¥å£®æ€§</strong>ï¼ˆå³å¯¹è±¡é€šè¿‡ <code>Object.create(null)</code> åˆ›å»ºæ—¶ï¼Œæ£€æµ‹æ–¹æ³•æ˜¯å¦ä»ç„¶å¯é ï¼›å¯¹è±¡è‡ªèº«æ˜¯å¦å¯ä»¥é‡å†™æ£€æµ‹æ–¹æ³•ï¼Œå¦‚ <code>hasOwnProperty</code>ï¼‰</p>
<ol>
<li><code>Object.prototype.hasOwnProperty.call(obj, prop): boolean</code> å…³æ³¨<strong>å¯¹è±¡è‡ªèº«ç‹¬æœ‰</strong>çš„å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âŒ</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âœ…</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>Reflect.ownKeys(obj).includes(prop)</code> å…³æ³¨<strong>å¯¹è±¡è‡ªèº«ç‹¬æœ‰</strong>çš„å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âŒ</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âœ…</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>prop in obj</code> å…³æ³¨<strong>å¯è®¿é—®</strong>çš„å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âœ…</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âœ…</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>Reflect.has(obj, prop)</code> å…³æ³¨<strong>å¯è®¿é—®</strong>çš„å±æ€§ï¼ˆ<code>in</code> æ“ä½œç¬¦çš„ä¸Šä½æ›¿ä»£ï¼‰
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âœ…</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âœ…</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>Object.keys(obj).includes(prop)</code> å…³æ³¨<strong>å¯¹è±¡è‡ªèº«ç‹¬æœ‰ã€å¯æšä¸¾çš„å­—ç¬¦ä¸²</strong>å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âŒ</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âŒ</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âŒ</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>Object.getOwnPropertyNames(obj).includes(prop)</code> å…³æ³¨<strong>å¯¹è±¡è‡ªèº«ç‹¬æœ‰çš„å­—ç¬¦ä¸²</strong>å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âŒ</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âœ…ï¼›Symbol å±æ€§ âŒ</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
<li><code>Object.getOwnPropertyNames(obj).includes(prop)</code> å…³æ³¨<strong>å¯¹è±¡è‡ªèº«ç‹¬æœ‰çš„ Symbol</strong> å±æ€§
<ul>
<li>è‡ªæœ‰å±æ€§ âœ…ï¼›ç»§æ‰¿å±æ€§ âŒ</li>
<li>å¯æšä¸¾å±æ€§ âœ…ï¼›ä¸å¯æšä¸¾å±æ€§ âœ…</li>
<li>å­—ç¬¦ä¸²å±æ€§ âŒï¼›Symbol å±æ€§ âœ…</li>
<li>å®‰å…¨æ€§ä¸å¥å£®æ€§ âœ…</li>
</ul>
</li>
</ol>
<p>ä½¿ç”¨å»ºè®®ï¼š</p>
<ul>
<li>
<p>æ£€æŸ¥è‡ªæœ‰å±æ€§ï¼š<code>Object.prototype.hasOwnProperty.call(obj, prop): boolean</code></p>
</li>
<li>
<p>æ£€æŸ¥å±æ€§çš„å¯è®¿é—®æ€§ï¼š<code>Reflect.has(obj, prop)</code></p>
</li>
<li>
<p>æœ€å¸¸ç”¨çš„åœºæ™¯ï¼ˆå¯¹è±¡è‡ªæœ‰ã€å¯æšä¸¾ã€å­—ç¬¦ä¸²ï¼‰ï¼š<code>Object.keys(obj).includes(prop)</code></p>
</li>
<li>
<p>æ£€æµ‹å±æ€§æ˜¯å¯¹è±¡ç‹¬æœ‰çš„ï¼Œè¿˜æ˜¯ç»§æ‰¿è‡ªçˆ¶ç±»çš„</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isOwnVsInherited</span>(<span class="params">obj, prop</span>): <span class="string">&quot;own&quot;</span> | <span class="string">&quot;inherited&quot;</span> | <span class="string">&quot;unknown&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(obj, prop)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;own&quot;</span>; <span class="comment">// å¯¹è±¡è‡ªç”±å±æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Reflect</span>.<span class="title function_">has</span>(obj, prop)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;inherited&quot;</span>; <span class="comment">// å¯¹è±¡åŸå‹é“¾ä¸Šçš„å±æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span> <span class="comment">// ä¸å­˜åœ¨çš„å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-åº”ç”¨ï¼šæ•°æ®åº“-ORM">6. åº”ç”¨ï¼šæ•°æ®åº“ ORM</h3>
<p>æ ¸å¿ƒæ€æƒ³ï¼šåˆ©ç”¨ Proxy åŠ¨æ€å“åº”ä¸ç¡®å®šçš„æ–¹æ³•åï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ç§å…·ä½“çš„ã€å‚æ•°åŒ–çš„æ“ä½œï¼ˆæ— è®ºæ˜¯ API è°ƒç”¨è¿˜æ˜¯ SQL æŸ¥è¯¢ï¼‰ï¼Œä»è€Œç”¨æå°‘çš„ä»£ç å®ç°å¼ºå¤§çš„åŠ¨æ€åŠŸèƒ½ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --- 1. æ¨¡æ‹Ÿæ•°æ®åº“ ---</span></span><br><span class="line"><span class="comment">// åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œè¿™é‡Œä¼šæ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± å’ŒæŸ¥è¯¢æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="keyword">const</span> db = &#123;</span><br><span class="line">  <span class="attr">users</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">&#x27;alice&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;alice@example.com&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">username</span>: <span class="string">&#x27;bob&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;bob@example.com&#x27;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">products</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">101</span>, <span class="attr">name</span>: <span class="string">&#x27;Laptop&#x27;</span>, <span class="attr">price</span>: <span class="number">1200</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">&#x27;Mouse&#x27;</span>, <span class="attr">price</span>: <span class="number">25</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿæ‰§è¡Œ SQL æŸ¥è¯¢çš„å‡½æ•°</span></span><br><span class="line">  <span class="title function_">execute</span>(<span class="params">sql</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[DB]  executing: <span class="subst">$&#123;sql&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€åŒ–çš„æ¨¡æ‹Ÿå™¨ï¼Œå¹¶éä¸€ä¸ªçœŸæ­£çš„SQLè§£æå™¨</span></span><br><span class="line">    <span class="comment">// ä»…ç”¨äºæ¼”ç¤º</span></span><br><span class="line">    <span class="keyword">if</span> (sql.<span class="title function_">includes</span>(<span class="string">&quot;FROM users WHERE username = &#x27;alice&#x27;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">users</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">u</span> =&gt;</span> u.<span class="property">username</span> === <span class="string">&#x27;alice&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sql.<span class="title function_">includes</span>(<span class="string">&quot;FROM users&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">users</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- 2. ORM æ¨¡å‹åˆ›å»ºå‡½æ•° ---</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createModel</span>(<span class="params">tableName</span>) &#123;</span><br><span class="line">  <span class="comment">// Proxy çš„ç›®æ ‡å¯¹è±¡å¯ä»¥æ˜¯ç©ºçš„ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½å°†è¢« get é™·é˜±æ‹¦æˆª</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// --- 3. Proxy çš„ get æ‹¦æˆªå™¨ ---</span></span><br><span class="line">    <span class="comment">// è¿™æ˜¯æ‰€æœ‰é­”æ³•å‘ç”Ÿçš„åœ°æ–¹</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, propKey, receiver</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Proxy] æ‹¦æˆªåˆ°å±æ€§è®¿é—®: <span class="subst">$&#123;<span class="built_in">String</span>(propKey)&#125;</span>`</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åŒ¹é… findBy&lt;Field&gt; æ¨¡å¼, e.g., &quot;findByUsername&quot;</span></span><br><span class="line">      <span class="keyword">const</span> findByMatch = <span class="title class_">String</span>(propKey).<span class="title function_">match</span>(<span class="regexp">/^findBy([A-Z]\w*)$/</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (findByMatch) &#123;</span><br><span class="line">        <span class="comment">// ä» &quot;findByUsername&quot; ä¸­æå– &quot;Username&quot;</span></span><br><span class="line">        <span class="keyword">const</span> fieldName = findByMatch[<span class="number">1</span>]; </span><br><span class="line">        <span class="comment">// å°†å­—æ®µåè½¬æ¢ä¸ºæ•°æ®åº“åˆ—å (e.g., &quot;Username&quot; -&gt; &quot;username&quot;)</span></span><br><span class="line">        <span class="keyword">const</span> columnName = fieldName.<span class="title function_">toLowerCase</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†æ¥æ”¶æŸ¥è¯¢å€¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">          <span class="comment">// åŠ¨æ€æ„å»º SQL è¯­å¥</span></span><br><span class="line">          <span class="keyword">const</span> sql = <span class="string">`SELECT * FROM <span class="subst">$&#123;tableName&#125;</span> WHERE <span class="subst">$&#123;columnName&#125;</span> = &#x27;<span class="subst">$&#123;value&#125;</span>&#x27;;`</span>;</span><br><span class="line">          <span class="comment">// æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›ç»“æœ</span></span><br><span class="line">          <span class="keyword">return</span> db.<span class="title function_">execute</span>(sql);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åŒ¹é… findAll æ¨¡å¼</span></span><br><span class="line">      <span class="keyword">if</span> (propKey === <span class="string">&#x27;findAll&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> sql = <span class="string">`SELECT * FROM <span class="subst">$&#123;tableName&#125;</span>;`</span>;</span><br><span class="line">          <span class="keyword">return</span> db.<span class="title function_">execute</span>(sql);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ¨¡å¼ï¼Œå¯ä»¥è¿”å› undefined æˆ–æŠ›å‡ºé”™è¯¯</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[Proxy] <span class="subst">$&#123;<span class="built_in">String</span>(propKey)&#125;</span> ä¸æ˜¯ä¸€ä¸ªæ”¯æŒçš„ ORM æ–¹æ³•ã€‚`</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- ä½¿ç”¨æˆ‘ä»¬ç®€å•çš„ ORM ---</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--- åˆ›å»º Users æ¨¡å‹ ---&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Users</span> = <span class="title function_">createModel</span>(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- è°ƒç”¨ findByUsername ---&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> foundUsers = <span class="title class_">Users</span>.<span class="title function_">findByUsername</span>(<span class="string">&#x27;alice&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æŸ¥è¯¢ç»“æœ:&quot;</span>, foundUsers);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- è°ƒç”¨ findAll ---&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> allUsers = <span class="title class_">Users</span>.<span class="title function_">findAll</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æŸ¥è¯¢ç»“æœ:&quot;</span>, allUsers);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- å°è¯•ä¸€ä¸ªä¸æ”¯æŒçš„æ–¹æ³• ---&quot;</span>);</span><br><span class="line"><span class="title class_">Users</span>.<span class="title function_">deleteEverything</span>();</span><br></pre></td></tr></table></figure>
<h2 id="Iterator">Iterator</h2>
<blockquote>
<p>æ ¸å¿ƒç†è§£ï¼šITERATOR ä¸ºæ•°æ®ç»“æ„æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è®¿é—®æœºåˆ¶çš„æ¥å£ã€‚</p>
</blockquote>
<h3 id="1-ç®€è¦æ¦‚è¿°-3">1. ç®€è¦æ¦‚è¿°</h3>
<ol>
<li>
<p>è§£é‡Šï¼šIteratorï¼ˆéå†å™¨ï¼‰æ˜¯ä¸€ç§ä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›<strong>ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶</strong>çš„æ¥å£ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚</p>
</li>
<li>
<p>Iterator çš„ä½œç”¨</p>
<ul>
<li>ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„<strong>è®¿é—®æ¥å£</strong></li>
<li>ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰<strong>æŸç§æ¬¡åºæ’åˆ—</strong></li>
<li>ä¸º <code>for...of</code> å¾ªç¯æä¾›æ”¯æŒ</li>
</ul>
</li>
<li>
<p>Iterator çš„éå†åŸç†ï¼šIterator æ˜¯ä¸€ä¸ª<strong>æŒ‡é’ˆå¯¹è±¡</strong>ï¼Œæœ€åˆæŒ‡å‘æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚å®ƒå…·æœ‰ä¸€ä¸ª <code>next</code> æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨ <code>next</code> æ–¹æ³•æ—¶ï¼ŒæŒ‡é’ˆä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š<code>value</code> è¡¨ç¤ºå½“å‰æˆå‘˜çš„å€¼ï¼Œ<code>done</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡ç¤ºéå†æ˜¯å¦å·²ç»“æŸã€‚</p>
</li>
<li>
<p>Iterator æ¥å£çš„ç±»å‹å®šä¹‰</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Iterable</span>&lt;T&gt; &#123;</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>](): <span class="title class_">Iterator</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="title function_">next</span>(value?: <span class="built_in">any</span>): <span class="title class_">IterationResult</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IterationResult</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">value</span>: T;</span><br><span class="line">  <span class="attr">done</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-Iterator-æ¥å£">2. Iterator æ¥å£</h3>
<h4 id="2-1-Symbol-iterator">2.1 Symbol.iterator</h4>
<ol>
<li>
<p>è§£é‡Šï¼šåªè¦ä¸€ä¸ªæ•°æ®ç»“æ„å…·æœ‰ <code>Symbol.iterator</code> å±æ€§ï¼Œå°±å¯ä»¥è¢«è§†ä¸ºâ€œ<strong>å¯éå†çš„</strong>â€ï¼ˆiterableï¼‰ï¼Œè¿™æ„å‘³ç€è¯¥æ•°æ®ç»“æ„<strong>éƒ¨ç½²äº† Iterator æ¥å£</strong>ã€‚<code>Symbol.iterator</code> å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯è¯¥æ•°æ®ç»“æ„é»˜è®¤çš„<strong>è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°</strong>ã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>
</li>
<li>
<p>éå†æ–¹å¼ï¼šå¯¹äºä¸€ä¸ªå¯éå†çš„æ•°æ®ç»“æ„ ITERABLEï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼éå†å…¶ä¸­çš„æ•°æ®æˆå‘˜ï¼Œ</p>
<ul>
<li>
<p><code>for...of</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> <span class="variable constant_">ITERABLE</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>while</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $iterator = <span class="variable constant_">ITERABLE</span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="keyword">var</span> $result = $iterator.<span class="title function_">next</span>();</span><br><span class="line"><span class="keyword">while</span> (!$result.<span class="property">done</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = $result.<span class="property">value</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">  $result = $iterator.<span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>åŸç”Ÿéƒ¨ç½² Iterator æ¥å£çš„æ•°æ®ç»“æ„ï¼šArrayã€Mapã€Setã€Stringã€TypedArrayã€å‡½æ•°çš„ arguments å¯¹è±¡ã€NodeList å¯¹è±¡</p>
<blockquote>
<p>å¯¹è±¡æ²¡æœ‰åŸç”Ÿéƒ¨ç½² Iterator æ¥å£ï¼Œå› ä¸ºå¯¹è±¡çš„æ•°æ®æ˜¯æ— åºçš„ã€‚å› æ­¤ï¼Œç»™å¯¹è±¡éƒ¨ç½²éå†å™¨æ¥å£ï¼Œå°±ç›¸å½“äºéƒ¨ç½²ä¸€ç§<strong>çº¿æ€§å˜æ¢</strong>ã€‚</p>
<p><code>for...of</code> éå†å­—ç¬¦ä¸²æ—¶ï¼Œç”šè‡³ä¼šæ­£ç¡®è¯†åˆ« 32 ä½çš„ UTF-16 å­—ç¬¦ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> <span class="string">&#x27;a\uD83D\uDC0A\u9CC4\u9C7C&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// &quot;a&quot;ï¼Œ&quot;ğŸŠ&quot;ï¼Œ&quot;é³„&quot;ï¼Œ&quot;é±¼&quot; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> iterator = arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 1, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 2, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 3, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: undefined, &quot;done&quot;: true &#125; </span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="2-2-æ¥å£éƒ¨ç½²">2.2 æ¥å£éƒ¨ç½²</h4>
<ol>
<li>
<p>è§£é‡Šï¼šä¸ºäº†è®©æ•°æ®ç»“æ„æ˜¯å¯éå†çš„ï¼Œå°±è¦ä¸ºå…¶éƒ¨ç½² Iterator æ¥å£ï¼Œå³åœ¨æ•°æ®ç»“æ„çš„ <code>Symbol.iterator</code> å±æ€§ä¸Šæ·»åŠ <strong>éå†å™¨ç”Ÿæˆæ–¹æ³•</strong>ï¼ˆåŸå‹é“¾ä¸Šæ·»åŠ ä¹Ÿå¥æ•ˆï¼‰ã€‚</p>
</li>
<li>
<p>Iterator æ¥å£éƒ¨ç½²ç¤ºä¾‹</p>
</li>
</ol>
<ul>
<li>
<p><strong>å¯¹è±¡</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">data</span>: [ <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span> ],</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; self.<span class="property">data</span>.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">value</span>: self.<span class="property">data</span>[index++],</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ç±»</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RangeIterator</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">start, stop</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = start;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stop</span> = stop;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="variable language_">this</span>.<span class="property">stop</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span>++;</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: value&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ç±»æ•°ç»„å¯¹è±¡</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> iterable = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">  <span class="attr">length</span>: <span class="number">3</span>,</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡å­˜åœ¨æ•°å€¼é”®åå’Œ <code>length</code> å±æ€§ï¼Œå°±ç§°ä¹‹ä¸ºç±»æ•°ç»„å¯¹è±¡ï¼Œæ­¤æ—¶éƒ¨ç½² Iterator æ¥å£æ—¶å¯ä»¥<strong>ç›´æ¥å¼•ç”¨æ•°ç»„çš„ Iterator æ¥å£</strong>ã€‚</p>
</blockquote>
</li>
</ul>
<ol start="3">
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>æ™®é€šå¯¹è±¡éƒ¨ç½²æ•°ç»„çš„ <code>Symbol.iterator</code> æ–¹æ³•ï¼Œå¹¶æ— æ•ˆæœã€‚</li>
<li>å¦‚æœ <code>Symbol.iterator</code> æ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼ˆå³ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼‰ï¼Œè§£é‡Šå¼•æ“å°†ä¼šæŠ¥é”™ã€‚</li>
</ul>
</li>
</ol>
<h4 id="2-3-è°ƒç”¨åœºåˆ">2.3 è°ƒç”¨åœºåˆ</h4>
<ol>
<li>
<p><strong>æ•°ç»„å’Œ Set çš„è§£æ„èµ‹å€¼</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> [x, y] = arr; <span class="comment">// x = 1,  y = 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>]);</span><br><span class="line"><span class="keyword">const</span> [a, b] = set; <span class="comment">// a = &quot;hello&quot;,  b = &quot;world&quot; </span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ‰©å±•è¿ç®—ç¬¦ <code>...</code></strong>ï¼ˆåªè¦æŸä¸ªæ•°æ®ç»“æ„éƒ¨ç½²äº† Iterator æ¥å£ï¼Œå°±å¯ä»¥å¯¹å®ƒä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†å…¶è½¬ä¸ºæ•°ç»„ï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...str]); <span class="comment">// [&quot;h&quot;, &quot;e&quot;, &quot;l&quot;, &quot;l&quot;, &quot;o&quot;, &quot; &quot;, &quot;w&quot;, &quot;o&quot;, &quot;r&quot;, &quot;l&quot;, &quot;d&quot;] </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">0</span>, ...arr, <span class="number">4</span>]); <span class="comment">// [0, 1, 2, 3, 4] </span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong><code>yield*</code></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generator = <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span>* [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = <span class="title function_">generator</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 1, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 2, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 3, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 4, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: 5, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: undefined, &quot;done&quot;: true &#125; </span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>æ•°ç»„çš„éå†</strong>ï¼ˆåŒ…æ‹¬ä»¥æ•°ç»„ä½œä¸ºå‚æ•°çš„åœºåˆï¼‰</p>
<ul>
<li>
<p><code>for ... of</code> å¾ªç¯</p>
</li>
<li>
<p><code>Array.from()</code></p>
</li>
<li>
<p><code>Map()</code>, <code>Set()</code>, <code>WeakMap()</code>, <code>WeakSet()</code></p>
</li>
<li>
<p><code>Promise.all()</code>ã€<code>Promise.race()</code></p>
</li>
<li>
<p>Â·Â·Â·Â·Â·Â·</p>
</li>
</ul>
</li>
</ol>
<h4 id="2-4-å‡ ä¸ªæ¦‚å¿µ">2.4 å‡ ä¸ªæ¦‚å¿µ</h4>
<p><code>Symbol.iterator</code>ã€Iterator æ¥å£ã€å¯éå†çš„ã€<code>for...of</code></p>
<ul>
<li>æ•°æ®ç»“æ„å…·æœ‰ <code>Symbol.iterator</code> å±æ€§ï¼Œäº¦å³æ•°æ®ç»“æ„éƒ¨ç½²äº† Iterator æ¥å£ï¼Œäº¦å³æ•°æ®ç»“æ„æ˜¯å¯éå†çš„ï¼Œäº¦å³æ•°æ®ç»“æ„å¯ä»¥ä½¿ç”¨ <code>for...of</code> éå†å…¶æ•°æ®æˆå‘˜ã€‚</li>
<li><code>for...of</code> å¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„ <code>Symbol.iterator</code> æ–¹æ³•ã€‚</li>
</ul>
<h3 id="3-Iterator-ç»“æ„">3. Iterator ç»“æ„</h3>
<ol>
<li>
<p>è§£é‡Šï¼šIterator æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ<strong>å¿…é¡»</strong>åŒ…å« <code>next()</code> æ–¹æ³•ï¼Œ<strong>å¯é€‰</strong>åŒ…å« <code>return()</code> å’Œ <code>throw()</code> æ–¹æ³•ã€‚</p>
<ul>
<li><code>next()</code>ï¼šç”¨äºéå†æ•°æ®ç»“æ„ä¸­çš„æ‰€æœ‰æ•°æ®æˆå‘˜ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç»“æ„ä¸º <code>&#123;value: any, done: boolean&#125;</code>ï¼Œå…¶ä¸­ <code>value</code> è¡¨ç¤ºå½“å‰éå†çš„æ•°æ®æˆå‘˜ï¼Œ<code>done</code> è¡¨ç¤ºæ•°æ®ç»“æ„æ˜¯å¦éå†å®Œæ¯•ã€‚</li>
<li><code>return()</code>ï¼šå½“ <code>for...of</code> å¾ªç¯å› ä¸º <code>break</code> æˆ– <code>throw</code> è¯­å¥æå‰é€€å‡ºæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</li>
<li><code>throw()</code>ï¼šä¸»è¦é…åˆ Generator å‡½æ•°ä½¿ç”¨ï¼Œè¯¦è§ä¸‹è¿°å…³äº Generator å‡½æ•°çš„ç¬”è®°ã€‚</li>
</ul>
</li>
<li>
<p>ç¤ºä¾‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iterableObj = &#123;</span><br><span class="line">    <span class="attr">data</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123;</span><br><span class="line">        <span class="keyword">const</span> self = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">value</span>: number;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (index &lt; self.<span class="property">data</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                    value = self.<span class="property">data</span>[index++];</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ­£åœ¨éå†æ•°æ® <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">                    <span class="keyword">return</span> &#123; value, <span class="attr">done</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ•°æ®ç»“æ„éå†ç»“æŸ&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">return</span>() &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`return æ–¹æ³•åœ¨éå† <span class="subst">$&#123;value&#125;</span> æ—¶è¢«è°ƒç”¨äº†`</span>);</span><br><span class="line">                <span class="keyword">return</span> &#123; value &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> iterableObj) &#123;</span><br><span class="line">    <span class="comment">// &quot;æ­£åœ¨éå†æ•°æ® 1&quot; </span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">break</span>; <span class="comment">// &quot;return æ–¹æ³•åœ¨éå† 1 æ—¶è¢«è°ƒç”¨äº†&quot; </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> iterableObj) &#123;</span><br><span class="line">        <span class="comment">// &quot;æ­£åœ¨éå†æ•°æ® 1&quot; </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// 1 </span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;error in for...of&#x27;</span>); <span class="comment">// &quot;return æ–¹æ³•åœ¨éå† 1 æ—¶è¢«è°ƒç”¨äº†&quot; </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="attr">e</span>:any) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>); <span class="comment">// &quot;error in for...of&quot; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœåœ¨ <code>for...of</code> å¾ªç¯ä¸­ï¼Œç”±äº <code>throw</code> è¯­å¥å¯¼è‡´è°ƒç”¨äº†å¯è¿­ä»£å¯¹è±¡çš„ Iterator çš„ <code>return()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šå…ˆæ‰§è¡Œ <code>return()</code> æ–¹æ³•ï¼Œç„¶åå†æŠ›å‡ºé”™è¯¯ã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="4-ç”Ÿæˆæ•°æ®ç»“æ„">4. ç”Ÿæˆæ•°æ®ç»“æ„</h3>
<p>æ•°ç»„ã€Setã€Map éƒ½å…·æœ‰ä»¥ä¸‹æ–¹æ³•ï¼Œè°ƒç”¨åè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œç”¨äºéå†ç”Ÿæˆæ•°æ®ç»“æ„çš„æ•°æ®æˆå‘˜ã€‚</p>
<ul>
<li><code>entries()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºéå†å½¢å¦‚ <code>[é”®åï¼Œé”®å€¼]</code> çš„æ•°ç»„ã€‚å¯¹äºæ•°ç»„ï¼Œæ¯æ¬¡éå†çš„æ˜¯ <code>[ç´¢å¼•å€¼ï¼Œå…ƒç´ å€¼]</code>ï¼›å¯¹äº Setï¼Œæ¯æ¬¡éå†çš„æ˜¯ <code>[å…ƒç´ å€¼ï¼Œå…ƒç´ å€¼]</code>ï¼›å¯¹äº Mapï¼Œæ¯æ¬¡éå†çš„æ˜¯ <code>[é”®åï¼Œé”®å€¼]</code>ã€‚</li>
<li><code>keys()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºéå†æ‰€æœ‰çš„é”®åã€‚</li>
<li><code>values()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äºéå†æ‰€æœ‰çš„é”®å€¼ã€‚</li>
</ul>
<h3 id="5-éå†è¯­æ³•æ¯”è¾ƒ">5. éå†è¯­æ³•æ¯”è¾ƒ</h3>
<p>è¿™é‡Œå±•ç¤ºå…¶ä»–å¾ªç¯çš„ç¼ºç‚¹ï¼Œä¸ <code>for...of</code> å¾ªç¯çš„ä¼˜ç‚¹ã€‚</p>
<ol>
<li>
<p><code>for</code> å¾ªç¯</p>
<ul>
<li>å†™æ³•æ¯”è¾ƒéº»çƒ¦</li>
</ul>
</li>
<li>
<p>æ•°ç»„çš„ <code>forEach</code> æ–¹æ³•</p>
<ul>
<li>æ— æ³•ä¸­é€”è·³å‡º <code>forEach</code> å¾ªç¯</li>
</ul>
</li>
<li>
<p><code>for...in</code> å¾ªç¯ï¼ˆç”¨äºéå†é”®åï¼‰</p>
<ul>
<li>
<p>éå†æ•°ç»„æ—¶ï¼Œéå†çš„é”®åæ˜¯ç´¢å¼•æ•°å­—å¯¹åº”çš„å­—ç¬¦ä¸²</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;boo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;zoo&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> idx <span class="keyword">in</span> arr)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(idx); <span class="comment">// &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¼šéå†åŸå‹ä¸Šçš„é”®å</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">19</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj1);</span><br><span class="line">obj2.<span class="property">gender</span> = <span class="string">&#x27;Male&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj2)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key); <span class="comment">// &quot;gender&quot;, &quot;name&quot;, &quot;age&quot; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¼šä»¥ä»»æ„é¡ºåºéå†é”®å</p>
</li>
</ul>
</li>
<li>
<p><code>for...of</code> å¾ªç¯ï¼ˆç”¨äºéå†å¯éå†å¯¹è±¡çš„æ•°æ®æˆå‘˜ï¼‰</p>
<ul>
<li>ç®€æ´çš„è¯­æ³•</li>
<li>æœ‰åºéå†</li>
<li>å¯ä¸­é€”è·³å‡ºå¾ªç¯ï¼ˆä¸ <code>break</code>ã€<code>continue</code> é…åˆä½¿ç”¨ï¼‰</li>
<li>éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ¥å£</li>
</ul>
</li>
</ol>
<h2 id="Generator-å‡½æ•°">Generator å‡½æ•°</h2>
<blockquote>
<p>æ ¸å¿ƒç†è§£ï¼šGENERATOR çš„æ‰§è¡Œç»“æœæ˜¯ ITERATORï¼ŒåŒæ—¶è¿™ä¸ª ITERATOR å¯ä»¥çœ‹ä½œæ˜¯ GENERATOR çš„å®ä¾‹ã€‚</p>
</blockquote>
<h3 id="1-ç®€è¦æ¦‚è¿°-4">1. ç®€è¦æ¦‚è¿°</h3>
<ol>
<li>
<p>è§£é‡Šï¼šGenerator å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§<strong>å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ</strong>ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸¤ç§è§’åº¦æ¥ç†è§£ï¼Œ</p>
<ul>
<li>è¯­æ³•ä¸Š
<ul>
<li>Generator å‡½æ•°æ˜¯ä¸€ä¸ª<strong>çŠ¶æ€æœº</strong>ï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚</li>
<li>Generator å‡½æ•°æ˜¯ä¸€ä¸ª<strong>éå†å™¨ç”Ÿæˆå‡½æ•°</strong>ï¼Œæ‰§è¡Œåè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œå¯ä»¥ä¾æ¬¡éå† Generator å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</li>
</ul>
</li>
<li>å½¢å¼ä¸Š
<ul>
<li>Generator å‡½æ•°ä½¿ç”¨ <code>function*</code> æ¥å®šä¹‰ï¼Œå³ <code>function</code> å…³é”®å­—å’Œå‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå· <code>*</code>ã€‚</li>
<li>Generator å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>yield</code> è¡¨è¾¾å¼å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Generator å‡½æ•°çš„æ‰§è¡Œæµç¨‹</p>
<ul>
<li>
<p>è°ƒç”¨ Generator å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª<strong>éå†å™¨å¯¹è±¡</strong>ï¼Œè¯¥å¯¹è±¡æ˜¯æŒ‡å‘å‡½æ•°å†…éƒ¨çš„æŒ‡é’ˆã€‚</p>
</li>
<li>
<p>æ¯æ¬¡è°ƒç”¨éå†å™¨å¯¹è±¡çš„ <code>next()</code> æ–¹æ³•æ—¶ï¼ŒGenerator å‡½æ•°ä¼š<strong>ä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ</strong>ï¼Œç›´åˆ°é‡åˆ° <code>yield</code> è¡¨è¾¾å¼æˆ– <code>return</code> è¯­å¥ã€‚<code>next()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç»“æ„ä¸º <code>&#123;value: any, done: boolean&#125;</code>ã€‚å…¶ä¸­ï¼Œ<code>value</code> è¡¨ç¤º Generator å‡½æ•°å½“å‰æ‰§è¡Œä½ç½®çš„å€¼ï¼ˆå³ <code>yield</code> æˆ– <code>return</code> åçš„è¡¨è¾¾å¼çš„å€¼ï¼‰ï¼Œè€Œ <code>done</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºéå†æ˜¯å¦å·²å®Œæˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">helloWorldGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ending&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hw = <span class="title function_">helloWorldGenerator</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hw.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: &quot;hello&quot;, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hw.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: &quot;world&quot;, &quot;done&quot;: false &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hw.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: &quot;ending&quot;, &quot;done&quot;: true &#125; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hw.<span class="title function_">next</span>()); <span class="comment">// &#123; &quot;value&quot;: undefined, &quot;done&quot;: true &#125; </span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼ï¼šåŸºäºä¸Šè¿°å†…å®¹å¯çŸ¥ï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ç§å¯ä»¥<strong>æš‚åœæ‰§è¡Œçš„å‡½æ•°</strong>ï¼Œè€Œ <code>yield</code> è¡¨è¾¾å¼å°±æ˜¯<strong>æš‚åœæ ‡å¿—</strong>ã€‚</p>
<ul>
<li>
<p><strong>æƒ°æ€§æ±‚å€¼</strong>ï¼ˆLazy Evaluationï¼‰ï¼š<code>yield</code> è¡¨è¾¾å¼åçš„è¡¨è¾¾å¼åªæœ‰å½“è°ƒç”¨ <code>next()</code> æ–¹æ³•ã€å†…éƒ¨æŒ‡é’ˆæŒ‡å‘è¯¥è¯­å¥æ—¶æ‰ä¼šæ‰§è¡Œã€‚</p>
</li>
<li>
<p><strong>æš‚ç¼“æ‰§è¡Œå‡½æ•°</strong>ï¼šå¦‚æœ Generator å‡½æ•°ä¸­ä¸ä½¿ç”¨ <code>yield</code> è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆåªæœ‰è°ƒç”¨è¯¥å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡çš„ <code>next()</code> æ–¹æ³•åï¼Œè¯¥å‡½æ•°çš„å†…éƒ¨ä»£ç æ‰ä¼šæ‰§è¡Œã€‚</p>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>
<p><code>yield</code> <strong>æ—¢æ˜¯ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„è¡¨è¾¾å¼</strong>ã€‚</p>
<ul>
<li>
<p><strong>æš‚åœå¹¶è¿”å›å€¼</strong>ï¼š<code>yield 123</code> ä¼šæš‚åœ Generator å‡½æ•°ï¼Œå¹¶æŠŠå€¼ <code>123</code> â€œäº§å‡ºâ€åˆ°å‡½æ•°å¤–éƒ¨ã€‚</p>
<p><strong>æ¥æ”¶è¾“å…¥å€¼</strong>ï¼šå½“å¤–éƒ¨è°ƒç”¨ <code>.next(inputValue)</code> æ—¶ï¼Œæ•´ä¸ª <code>yield</code> è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ <code>yield 123</code>ï¼‰ä¼š<strong>è¢« <code>inputValue</code> è¿™ä¸ªå€¼æ‰€æ›¿ä»£</strong>ã€‚</p>
</li>
</ul>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼åªèƒ½ç”¨åœ¨ Generator å‡½æ•°é‡Œé¢ã€‚</p>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼å¦‚æœç”¨åœ¨å¦ä¸€ä¸ªè¡¨è¾¾å¼ä¹‹ä¸­ï¼Œå¿…é¡»æ”¾åœ¨åœ†æ‹¬å·é‡Œé¢ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello&#x27;</span> + (<span class="keyword">yield</span> <span class="number">123</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>yield</code> è¡¨è¾¾å¼ç”¨ä½œå‡½æ•°å‚æ•°æˆ–æ”¾åœ¨èµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼Œå¯ä»¥ä¸åŠ æ‹¬å·ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">foo</span>(<span class="keyword">yield</span> <span class="string">&#x27;a&#x27;</span>, <span class="keyword">yield</span> <span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> input = <span class="keyword">yield</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>
<p>å¯ä»¥æŠŠ Generator å‡½æ•°èµ‹å€¼ç»™å¯¹è±¡çš„ <code>Symbol.iterator</code> å±æ€§ï¼Œä»è€Œä½¿å¾—è¯¥å¯¹è±¡å…·æœ‰ Iterator æ¥å£ï¼Œä½¿å…¶æˆä¸ºå¯éå†å¯¹è±¡ã€‚</p>
</li>
<li>
<p>Generator å‡½æ•°æ‰§è¡Œåï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡æœ¬èº«ä¹Ÿå…·æœ‰<code>Symbol.iterator</code> å±æ€§ï¼Œæ‰§è¡Œåè¿”å›è‡ªèº«ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">numbers</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = <span class="title function_">numbers</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(iterator[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() === iterator); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šJavaScript <strong>å†…ç½®çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚ Array, Map, Setï¼‰æ‰€è¿”å›çš„è¿­ä»£å™¨</strong>ï¼Œé€šå¸¸ä¹Ÿéµå¾ªè¿™ä¸ªæ¨¡å¼ã€‚</p>
</blockquote>
</li>
<li>
<p>åœ¨ä½¿ç”¨ <code>for...of</code> å¾ªç¯éå† Generator å‡½æ•°è¿”å›çš„éå†å™¨æ—¶ï¼Œéå†ç»“æœä¸åŒ…æ‹¬ Generator å‡½æ•°ä¸­ <code>return</code> è¯­å¥è¿”å›çš„å€¼ã€‚<strong><code>return</code> è¯­å¥ä»…ç”¨äºæ ‡è¯†è¿­ä»£çš„ç»“æŸ</strong>ï¼Œè€Œå…¶è¿”å›çš„å€¼ä¸ä¼šè¢« <code>for...of</code> å¾ªç¯æ•è·ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">numbers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...<span class="title function_">numbers</span>()]); <span class="comment">// [1, 2] </span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="title function_">numbers</span>())); <span class="comment">// [1, 2] </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [x, y] = <span class="title function_">numbers</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x, y); <span class="comment">// 1, 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> <span class="title function_">numbers</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x) <span class="comment">// 1, 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰€æœ‰ä¸ <code>for...of</code> éå†åŸç†ç›¸åŒçš„è¯­æ³•ï¼Œéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœã€‚</p>
</blockquote>
</li>
<li>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ˜¯ Generator å‡½æ•°ï¼Œå¯ä»¥<strong>ç®€å†™</strong>æˆä¸‹é¢çš„å½¢å¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  * <span class="title function_">myGeneratorMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">    Â·Â·Â·</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>Generator å‡½æ•°æ‰§è¡Œè¿”å›çš„éå†å™¨æ˜¯ Generator å‡½æ•°çš„å®ä¾‹</strong>ï¼Œç»§æ‰¿äº† Generator å‡½æ•°çš„ <code>prototype</code> å¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="2-next-æ–¹æ³•çš„å‚æ•°">2. next æ–¹æ³•çš„å‚æ•°</h3>
<ol>
<li>
<p>è§£é‡Šï¼š<code>yield</code> è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å› <code>undefined</code>ã€‚<code>next</code> æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œ<strong>ä¸Šä¸€ä¸ª <code>yield</code> è¡¨è¾¾å¼çš„è¿”å›å€¼</strong>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span> * (<span class="title function_">yield</span> (x + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">var</span> z = <span class="title function_">yield</span> (y / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> (x + y + z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">foo</span>(<span class="number">5</span>);</span><br><span class="line">b.<span class="title function_">next</span>() <span class="comment">// &#123; value:6, done:false &#125;</span></span><br><span class="line">b.<span class="title function_">next</span>(<span class="number">12</span>) <span class="comment">// &#123; value:8, done:false &#125;</span></span><br><span class="line">b.<span class="title function_">next</span>(<span class="number">13</span>) <span class="comment">// &#123; value:42, done:true &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>é€šè¿‡ <code>next()</code> æ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥åœ¨ Generator å‡½æ•°è¿è¡Œçš„ä¸åŒé˜¶æ®µï¼Œä»å¤–éƒ¨å‘å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œè°ƒæ•´å‡½æ•°è¡Œä¸ºã€‚</li>
<li>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>next()</code> æ–¹æ³•æ—¶ï¼Œä¼ é€’å‚æ•°æ˜¯æ— æ•ˆçš„ã€‚</li>
</ul>
</li>
</ol>
<h3 id="3-Generator-å‡½æ•°çš„åŸå‹æ–¹æ³•">3. Generator å‡½æ•°çš„åŸå‹æ–¹æ³•</h3>
<p>Generator å‡½æ•°çš„æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ªéå†å™¨ï¼Œå¯ä»¥è¢«è§†ä¸º Generator å‡½æ•°çš„å®ä¾‹å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸‹è¿°çš„ <code>throw()</code>ã€<code>return()</code> æ–¹æ³•éƒ½æ˜¯éå†å™¨å¯¹è±¡æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<h4 id="3-1-Generator-prototype-throw">3.1 Generator.prototype.throw()</h4>
<ol>
<li>
<p>è§£é‡Šï¼šåœ¨ Generator å‡½æ•°ä½“å¤–<strong>æŠ›å‡ºé”™è¯¯</strong>ï¼Œè¯¥é”™è¯¯å¯ä»¥åœ¨ Generator å‡½æ•°ä½“å†…è¢«æ•è·ã€‚</p>
</li>
<li>
<p>è¯­æ³•ï¼š<code>integrator.throw(e)</code></p>
<ul>
<li><code>e</code>ï¼šè¢«æŠ›å‡ºçš„é”™è¯¯ï¼Œå»ºè®®ä¸º <code>Error</code> å¯¹è±¡çš„å®ä¾‹ã€‚</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>
<p><code>throw</code> æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯è¦è¢«å†…éƒ¨æ•è·ï¼Œå‰ææ˜¯å¿…é¡»<strong>è‡³å°‘æ‰§è¡Œè¿‡ä¸€æ¬¡ <code>next</code> æ–¹æ³•</strong>ï¼Œå¦åˆ™ï¼Œç”±äº Generator å‡½æ•°è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œï¼Œ<code>throw</code> æ–¹æ³•æŠ›å‡ºçš„é”™è¯¯åªèƒ½æŠ›å‡ºåœ¨å‡½æ•°å¤–éƒ¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gen = <span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">throw</span>(<span class="keyword">new</span> <span class="title class_">Error</span>()))<span class="comment">// &quot;æ‰§è¡Œ JavaScript å¤±è´¥:&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>throw</code> æ–¹æ³•è¢«å†…éƒ¨æ•è·ä»¥åï¼Œä¼šé™„å¸¦æ‰§è¡Œåˆ°ä¸‹ä¸€æ¡ <code>yield</code> è¡¨è¾¾å¼ï¼Œè¿™ç§æƒ…å†µä¸‹<strong>ç­‰åŒäºæ‰§è¡Œä¸€æ¬¡ <code>next</code> æ–¹æ³•</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>throw</code> æ–¹æ³•æ‰§è¡Œåï¼Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªç»“æ„ä¸º <code>&#123;value: any, done: boolean&#125;</code> çš„å¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gen = <span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>())<span class="comment">// &#123; value:1, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">throw</span>(<span class="keyword">new</span> <span class="title class_">Error</span>())) <span class="comment">// &#123; value:3, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:4, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:undefined, done:true &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:undefined, done:true &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸€æ—¦ Generator æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯ï¼Œä¸”æ²¡æœ‰è¢«å†…éƒ¨æ•è·ï¼Œå°±<strong>ä¸ä¼šå†æ‰§è¡Œä¸‹å»</strong>äº†ã€‚å¦‚æœæ­¤åè¿˜è°ƒç”¨ <code>next</code> æ–¹æ³•ï¼Œå°†è¿”å›ä¸€ä¸ª <code>value</code> å±æ€§ç­‰äº <code>undefined</code>ã€<code>done</code> å±æ€§ç­‰äº <code>true</code> çš„å¯¹è±¡ï¼Œå³ JavaScript å¼•æ“è®¤ä¸ºè¿™ä¸ª Generator å·²ç»è¿è¡Œç»“æŸäº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gen = <span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:1, done:false &#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">throw</span>(<span class="keyword">new</span> <span class="title class_">Error</span>()))</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:undefined, done:true &#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:undefined, done:true &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="3-2-Generator-prototype-return">3.2 Generator.prototype.return()</h4>
<ol>
<li>
<p>è§£é‡Šï¼šåœ¨ Generator å‡½æ•°ä½“å¤–è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚</p>
</li>
<li>
<p>è¯­æ³•ï¼š<code>integrator.return(value)</code></p>
<ul>
<li><code>value</code>ï¼šè¿”å›çš„å€¼ã€‚å¦‚æœä¸æä¾›è¯¥å‚æ•°ï¼Œåˆ™é»˜è®¤ <code>value = undefined</code>ã€‚</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>
<p>å¦‚æœ Generator å‡½æ•°å†…éƒ¨æœ‰ <code>try...finally</code> ä»£ç å—ï¼Œä¸”æ­£åœ¨æ‰§è¡Œ <code>try</code> ä»£ç å—ï¼Œé‚£ä¹ˆ <code>return</code> æ–¹æ³•ä¼šå¯¼è‡´ç«‹åˆ»è¿›å…¥ <code>finally</code> ä»£ç å—ï¼Œæ‰§è¡Œå®Œä»¥åï¼Œå†è¿”å› <code>return</code> æ–¹æ³•æŒ‡å®šçš„è¿”å›å€¼ï¼Œæ­¤æ—¶æ•´ä¸ªå‡½æ•°æ‰ä¼šç»“æŸã€‚</p>
</li>
<li>
<p>ä¸ <code>throw</code> æ–¹æ³•ç±»ä¼¼ï¼Œ<code>return</code> æ–¹æ³•æ‰§è¡Œåï¼Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªç»“æ„ä¸º <code>&#123;value: any, done: boolean&#125;</code> çš„å¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gen = <span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>())<span class="comment">// &#123; value:1, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">throw</span>(<span class="keyword">new</span> <span class="title class_">Error</span>())) <span class="comment">// &#123; value:3, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">return</span>(<span class="number">100</span>)) <span class="comment">// &#123; value:5, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:6, done:false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:100, done:true &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value:undefined, done:true &#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="3-3-next-ã€throw-ã€return-å¯¹æ¯”">3.3 next()ã€throw()ã€return() å¯¹æ¯”</h4>
<p><code>next()</code>ã€<code>throw()</code>ã€<code>return()</code> æœ¬è´¨ä¸Šéƒ½æ˜¯è®© Generator å‡½æ•°<strong>æ¢å¤æ‰§è¡Œ</strong>ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„è¯­å¥æ›¿æ¢ <code>yield</code> è¡¨è¾¾å¼ã€‚å‡è®¾éå†å™¨å¯¹è±¡å½“å‰æŒ‡å‘ <code>let result = yield x + y</code>ï¼Œé‚£ä¹ˆä»¥ä¸‹æ–¹æ³•çš„æ‰§è¡Œç›¸å½“äºå°† <code>yield</code> è¡¨è¾¾å¼æ›¿æ¢ä¸ºï¼Œ</p>
<ul>
<li><code>next(para)</code>ï¼š<code>let result = para</code></li>
<li><code>throw(e)</code>ï¼š<code>let result = throw(e)</code></li>
<li><code>return(value)</code>ï¼š<code>let result = return value</code></li>
</ul>
<h3 id="4-yield-è¡¨è¾¾å¼">4. yield* è¡¨è¾¾å¼</h3>
<ol>
<li>
<p>è§£é‡Šï¼šåœ¨ Generator å‡½æ•°ä¸­ä½¿ç”¨ <code>yield*</code> è¡¨è¾¾å¼ï¼Œç›¸å½“äº<strong>å§”æ‰˜æ‰§è¡Œ</strong>å¦ä¸€ä¸ªéå†å™¨å¯¹è±¡æˆ–å¯éå†å¯¹è±¡çš„æ‰€æœ‰å…ƒç´ ã€‚<code>yield*</code> ä¼šè‡ªåŠ¨éå†è¯¥å¯¹è±¡çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ <strong>å•ç‹¬ä½¿ç”¨ <code>yield</code> è¡¨è¾¾å¼è¿›è¡Œäº§å‡º</strong>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;x&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> value = <span class="keyword">yield</span>* <span class="title function_">foo</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;y&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> i = <span class="title function_">bar</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i.<span class="title function_">next</span>().<span class="property">value</span>) <span class="comment">// &quot;x&quot; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i.<span class="title function_">next</span>().<span class="property">value</span>) <span class="comment">// &quot;a&quot; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i.<span class="title function_">next</span>().<span class="property">value</span>) <span class="comment">// &quot;b&quot;</span></span><br><span class="line"><span class="comment">// &quot;hello&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i.<span class="title function_">next</span>().<span class="property">value</span>) <span class="comment">// &quot;y&quot; </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i.<span class="title function_">next</span>().<span class="property">value</span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è¯­æ³•</p>
<ul>
<li><code>yield* éå†å™¨å¯¹è±¡</code></li>
<li><code>yield* å¯éå†å¯¹è±¡</code></li>
</ul>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>å¦‚æœ <code>yield*</code> åé¢è·Ÿéšçš„æ˜¯ä¸€ä¸ª Generator å‡½æ•°çš„éå†å™¨ï¼Œå¹¶ä¸”è¯¥ Generator å‡½æ•°åŒ…å« <code>return</code> è¯­å¥ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>var value = yield* iterator</code> çš„å½¢å¼æ¥<strong>è·å– <code>return</code> è¯­å¥è¿”å›çš„å€¼</strong>ã€‚</li>
</ul>
</li>
</ol>
<h3 id="5-Generator-ä¸åç¨‹">5. Generator ä¸åç¨‹</h3>
<ol>
<li>åç¨‹ï¼ˆcoroutineï¼‰ï¼šä¸€ç§ç¨‹åºè¿è¡Œçš„æ–¹å¼ï¼Œå¯ä»¥ç†è§£æˆ â€œåä½œçš„çº¿ç¨‹â€ æˆ– â€œåä½œçš„å‡½æ•°â€ã€‚</li>
<li>åç¨‹çš„å®ç°æ–¹å¼
<ul>
<li>å•çº¿ç¨‹å®ç°ï¼šç‰¹æ®Šçš„å­ä¾‹ç¨‹ï¼ˆsubroutineï¼‰</li>
<li>å¤šçº¿ç¨‹å®ç°ï¼šç‰¹æ®Šçš„çº¿ç¨‹</li>
</ul>
</li>
<li>åç¨‹ Vs å­ä¾‹ç¨‹
<ul>
<li>å­ä¾‹ç¨‹
<ul>
<li>ä¸€ä¸ªè°ƒç”¨æ ˆã€‚</li>
<li>å †æ ˆå¼â€œåè¿›å…ˆå‡ºâ€çš„æ‰§è¡Œæ–¹å¼ï¼Œåªæœ‰å½“è°ƒç”¨çš„å­å‡½æ•°å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šç»“æŸæ‰§è¡Œçˆ¶å‡½æ•°ã€‚</li>
</ul>
</li>
<li>åç¨‹
<ul>
<li>å¤šä¸ªè°ƒç”¨æ ˆã€‚</li>
<li>å¤šä¸ªçº¿ç¨‹ï¼ˆå•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œå³å¤šä¸ªå‡½æ•°ï¼‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰å¤„äºæ­£åœ¨è¿è¡Œçš„çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰éƒ½å¤„äºæš‚åœæ€ï¼ˆsuspendedï¼‰ï¼Œçº¿ç¨‹ï¼ˆæˆ–å‡½æ•°ï¼‰ä¹‹é—´å¯ä»¥äº¤æ¢æ‰§è¡Œæƒã€‚</li>
</ul>
</li>
</ul>
</li>
<li>åç¨‹ Vs æ™®é€šçº¿ç¨‹
<ul>
<li>æ™®é€šçº¿ç¨‹ï¼šåŒä¸€æ—¶é—´å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li>
<li>åç¨‹ï¼šåŒä¸€æ—¶é—´è¿è¡Œçš„åç¨‹åªèƒ½æœ‰ä¸€ä¸ªï¼Œå…¶ä»–åç¨‹éƒ½å¤„äºæš‚åœçŠ¶æ€ã€‚</li>
</ul>
</li>
<li>Generator å‡½æ•° - åŠåç¨‹ï¼šGenerator å‡½æ•°è¢«ç§°ä¸ºâ€œåŠåç¨‹â€ï¼ˆsemi-coroutineï¼‰ï¼Œæ„æ€æ˜¯åªæœ‰ Generator å‡½æ•°çš„è°ƒç”¨è€…ï¼Œæ‰èƒ½å°†ç¨‹åºçš„æ‰§è¡Œæƒè¿˜ç»™ Generator å‡½æ•°ã€‚æ­¤å¤–ï¼ŒGenerator ä½¿ç”¨ <code>yield</code> è¡¨è¾¾å¼äº¤æ¢æ§åˆ¶æƒã€‚</li>
<li>Generator å‡½æ•° - ä¸Šä¸‹æ–‡ï¼šGenerator å‡½æ•°æ‰§è¡Œäº§ç”Ÿçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¸€æ—¦é‡åˆ° <code>yield</code> å‘½ä»¤ï¼Œå°±ä¼šæš‚æ—¶é€€å‡ºå †æ ˆï¼Œä½†æ˜¯å¹¶ä¸æ¶ˆå¤±ï¼Œé‡Œé¢çš„æ‰€æœ‰å˜é‡å’Œå¯¹è±¡ä¼š<strong>å†»ç»“</strong>åœ¨å½“å‰çŠ¶æ€ã€‚ç­‰åˆ°å¯¹å®ƒæ‰§è¡Œ <code>next</code> å‘½ä»¤æ—¶ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒåˆä¼šé‡æ–°åŠ å…¥è°ƒç”¨æ ˆï¼Œå†»ç»“çš„å˜é‡å’Œå¯¹è±¡æ¢å¤æ‰§è¡Œã€‚</li>
</ol>
<h2 id="ArrayBuffer">ArrayBuffer</h2>
<h3 id="1-ç®€è¦æ¦‚è¿°-5">1. ç®€è¦æ¦‚è¿°</h3>
<ol>
<li>
<p>è§£é‡Šï¼š<code>ArrayBuffer</code> å¯¹è±¡ä»£è¡¨<strong>å†…å­˜ä¹‹ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®</strong>ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡<strong>è§†å›¾</strong>ï¼ˆ<code>TypedArray</code> æˆ– <code>DataView</code>ï¼‰è¿›è¡Œæ“ä½œã€‚ç”±äºè§†å›¾éƒ¨ç½²äº†æ•°ç»„æ¥å£ï¼Œå› æ­¤å¯ä»¥<strong>ä½¿ç”¨æ•°ç»„çš„æ–¹æ³•æ“ä½œå†…å­˜</strong>ã€‚<code>ArrayBuffer</code> å¯¹è±¡ã€<code>TypedArray</code> è§†å›¾å’Œ <code>DataView</code> è§†å›¾ç»Ÿç§°ä¸º<strong>äºŒè¿›åˆ¶æ•°ç»„</strong>ã€‚</p>
</li>
<li>
<p>è§†å›¾ï¼š<code>TypedArray</code> è§†å›¾ç”¨äºè¯»å†™<strong>ç®€å•ç±»å‹</strong>çš„äºŒè¿›åˆ¶æ•°æ®ï¼›<code>DataView</code> è§†å›¾æ”¯æŒè‡ªå®šä¹‰å¤åˆæ ¼å¼çš„è§†å›¾ï¼Œå› æ­¤ç”¨äºè¯»å†™<strong>å¤æ‚ç±»å‹</strong>çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<ul>
<li>
<p><code>TypedArray</code> è§†å›¾ï¼š9 ç§ç±»å‹ï¼Œå¦‚ Uint8Array æ•°ç»„è§†å›¾ã€Int16Array æ•°ç»„è§†å›¾ã€Float32Array æ•°ç»„è§†å›¾ç­‰ï¼Œå¯¹åº” 9 ç§æ•°æ®ç±»å‹ã€‚</p>
</li>
<li>
<p><code>DataView</code> è§†å›¾ï¼šå¯ä»¥è‡ªå®šä¹‰æ¯ä¸ªå­—èŠ‚å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œå¦‚ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ Uint8ï¼Œç¬¬äºŒã€ä¸‰ä¸ªå­—èŠ‚æ˜¯ Int16ï¼Œç¬¬å››ä¸ªå­—èŠ‚å¼€å§‹æ˜¯ Float32ç­‰ï¼Œæ”¯æŒ 8 ç§æ•°æ®ç±»å‹ï¼ˆä¸ <code>TypedView</code> è§†å›¾ç›¸æ¯”ï¼Œä¸æ”¯æŒ Uint8C æ•°æ®ç±»å‹ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ•°æ®ç±»å‹</th>
<th style="text-align:center">å­—èŠ‚é•¿åº¦</th>
<th style="text-align:center">å«ä¹‰</th>
<th style="text-align:center">å¯¹åº”çš„ C è¯­è¨€ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Int8</td>
<td style="text-align:center">1</td>
<td style="text-align:center">8 ä½å¸¦ç¬¦å·æ•´æ•°</td>
<td style="text-align:center">signed char</td>
</tr>
<tr>
<td style="text-align:center">Uint8</td>
<td style="text-align:center">1</td>
<td style="text-align:center">8 ä½ä¸å¸¦ç¬¦å·æ•´æ•°</td>
<td style="text-align:center">unsigned char</td>
</tr>
<tr>
<td style="text-align:center">Uint8C</td>
<td style="text-align:center">1</td>
<td style="text-align:center">8 ä½ä¸å¸¦ç¬¦å·æ•´æ•°ï¼ˆè‡ªåŠ¨è¿‡æ»¤æº¢å‡ºï¼‰</td>
<td style="text-align:center">unsigned char</td>
</tr>
<tr>
<td style="text-align:center">Int16</td>
<td style="text-align:center">2</td>
<td style="text-align:center">16 ä½å¸¦ç¬¦å·æ•´æ•°</td>
<td style="text-align:center">short</td>
</tr>
<tr>
<td style="text-align:center">Uint16</td>
<td style="text-align:center">2</td>
<td style="text-align:center">16 ä½ä¸å¸¦ç¬¦å·æ•´æ•°</td>
<td style="text-align:center">unsigned short</td>
</tr>
<tr>
<td style="text-align:center">Int32</td>
<td style="text-align:center">4</td>
<td style="text-align:center">32 ä½å¸¦ç¬¦å·æ•´æ•°</td>
<td style="text-align:center">int</td>
</tr>
<tr>
<td style="text-align:center">Uint32</td>
<td style="text-align:center">4</td>
<td style="text-align:center">32 ä½ä¸å¸¦ç¬¦å·çš„æ•´æ•°</td>
<td style="text-align:center">unsigned int</td>
</tr>
<tr>
<td style="text-align:center">Float32</td>
<td style="text-align:center">4</td>
<td style="text-align:center">32 ä½æµ®ç‚¹æ•°</td>
<td style="text-align:center">float</td>
</tr>
<tr>
<td style="text-align:center">Float64</td>
<td style="text-align:center">8</td>
<td style="text-align:center">64 ä½æµ®ç‚¹æ•°</td>
<td style="text-align:center">double</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ol>
<h3 id="2-ArrayBuffer">2. ArrayBuffer</h3>
<ol>
<li>
<p>è§£é‡Šï¼š<code>ArrayBuffer</code> å¯¹è±¡ä»£è¡¨<strong>å†…å­˜ä¹‹ä¸­çš„ä¸€æ®µäºŒè¿›åˆ¶æ•°æ®</strong>ï¼Œä»…æ”¯æŒé€šè¿‡<strong>è§†å›¾</strong>è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
</li>
<li>
<p>åŸºæœ¬ä½¿ç”¨</p>
<ul>
<li>
<p><strong><code>ArrayBuffer</code> çš„åˆ›å»º</strong>ï¼šæŒ‡å®š<strong>è¿ç»­çš„</strong>å†…å­˜åŒºåŸŸå¤§å°ä¸º <code>byteLength</code>ï¼ŒåŒæ—¶æ¯ä¸ªå­—èŠ‚çš„é»˜è®¤å€¼ä¸º 0ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(byteLength)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong><code>ArrayBuffer</code> çš„æ“ä½œ</strong>ï¼ˆé€šè¿‡è§†å›¾ï¼‰</p>
<ul>
<li>
<p><code>DataView</code> è§†å›¾ï¼šæŒ‡å®š <code>ArrayBuffer</code> å®ä¾‹ä¸ºå‚æ•°åˆ›å»ºè§†å›¾å®ä¾‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataView = <span class="keyword">new</span> <span class="title class_">DataView</span>(buffer);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dataView.<span class="title function_">getInt8</span>(<span class="number">0</span>));</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>TypedArray</code> è§†å›¾ï¼šæŒ‡å®š <code>ArrayBuffer</code> å®ä¾‹ä¸ºå‚æ•°åˆ›å»ºè§†å›¾å®ä¾‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> int8Array = <span class="keyword">new</span> <span class="title class_">Int8Array</span>(buffer);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(int8Array.<span class="property">length</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šä¸ DataView è§†å›¾ä¸åŒï¼ŒTypedArray è§†å›¾æ˜¯ä¸€ç»„æ„é€ å‡½æ•°ï¼Œä»£è¡¨ä¸åŒçš„æ•°æ®æ ¼å¼</p>
</blockquote>
</li>
<li>
<p><code>TypedArray</code> è§†å›¾ï¼šæŒ‡å®š <code>Array</code> å®ä¾‹ä¸ºå‚æ•°åˆ›å»ºè§†å›¾å®ä¾‹ï¼Œæ­¤æ—¶ä¼šéšå«åœ°åˆ›å»ºä¸€ä¸ª <code>ArrayBuffer</code> å¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> int8Array2 = <span class="keyword">new</span> <span class="title class_">Int8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(int8Array2.<span class="property">length</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>ArrayBuffer</code> çš„å±æ€§å’Œæ–¹æ³•</p>
<ul>
<li>
<p><code>ArrayBuffer.prototype.byteLength: number</code> è¿”å› ArrayBuffer æ‰€åˆ†é…çš„<strong>å†…å­˜åŒºåŸŸçš„å­—èŠ‚é•¿åº¦</strong>ã€‚å†…å­˜åŒºåŸŸè¦æ±‚<strong>è¿ç»­</strong>ï¼Œå› æ­¤å¤§å†…å­˜åŒºåŸŸå¯èƒ½ä¼šåˆ†é…å¤±è´¥ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•<strong>æ£€æµ‹å†…å­˜æ˜¯å¦åˆ†é…æˆåŠŸ</strong>ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (buffer.<span class="property">byteLength</span> === n) &#123;</span><br><span class="line">  <span class="comment">// æˆåŠŸ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>ArrayBuffer.prototype.slice(start[, end]): ArrayBuffer</code> <strong>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>ArrayBuffer</code> å¯¹è±¡ï¼Œå…¶å†…å­˜åŒºåŸŸæ•°æ®æ‹·è´è‡ªåŸ <code>ArrayBuffer</code> å†…å­˜åŒºåŸŸ <code>[start end)</code> éƒ¨åˆ†çš„å­—èŠ‚æ•°æ®</strong>ã€‚è¿™é‡Œçš„ <code>start</code>ã€<code>end</code> æ˜¯å­—èŠ‚åºå·ï¼Œå¦‚æœä¸æŒ‡å®š <code>end</code>ï¼Œåˆ™æ‹·è´åŸ <code>ArrayBuffer</code> ä» <code>start</code> å­—èŠ‚å¼€å§‹çš„æ‰€æœ‰å­—èŠ‚æ•°æ®ã€‚</p>
</li>
<li>
<p><code>ArrayBuffer.isView(obj): boolean</code> è¡¨ç¤ºå‚æ•° <code>obj</code> <strong>æ˜¯å¦ä¸º <code>ArrayBuffer</code> çš„è§†å›¾å®ä¾‹</strong>ï¼Œå³æ˜¯å¦ä¸º <code>TypedArray</code> å®ä¾‹æˆ– <code>DataView </code>å®ä¾‹ã€‚</p>
</li>
</ul>
</li>
<li>
<p>Conversionï¼š<code>ArrayBuffer</code> åŠå¯¹åº”çš„ <code>TypedArray</code> &lt;â€“&gt; <code>string</code></p>
<ul>
<li>
<p><code>ArrayBuffer</code> åŠå…¶å¯¹åº”çš„ <code>TypedArray</code> --&gt; <code>string</code>ï¼š<code>TextDeocder</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step1. </span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">decoder</span>: <span class="title class_">TextDecoder</span> = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>(outputEncoding); <span class="comment">// outputEncoding æŒ‡å®šè§£ç çš„ç¼–ç æ ¼å¼ï¼Œé»˜è®¤ä¸º &#x27;utf-8&#x27;</span></span><br><span class="line"><span class="comment">// Step2. </span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">output</span>: string = decoder.<span class="title function_">decode</span>(input); <span class="comment">// input çš„ç±»å‹ä¸º ArrayBuffer | Uint8Array | Int8Array | Uint16Array | Int16Array | Uint32Array | Int32Array</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>string</code> --&gt; <code>ArrayBuffer</code> åŠå…¶å¯¹åº”çš„ <code>TypedArray</code>ï¼š<code>TextEncoder</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step1. </span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">encoder</span>: <span class="title class_">TextEncoder</span> = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line"><span class="comment">// Step2. </span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">view</span>: <span class="title class_">Uint8Array</span> = <span class="title function_">encoder</span>(input); <span class="comment">// input çš„ç±»å‹ä¸º string</span></span><br><span class="line"><span class="comment">// Step3.</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">buffer</span>: <span class="title class_">ArrayBuffer</span> = view.<span class="property">buffer</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="3-TypedArray">3. TypedArray</h3>
<h4 id="3-1-æ¦‚å¿µç†è§£">3.1 æ¦‚å¿µç†è§£</h4>
<ol>
<li>
<p>è§†å›¾ï¼ˆviewï¼‰ï¼šå³å¯¹ <code>ArrayBuffer</code> å¯¹è±¡å¯¹åº”<strong>å†…å­˜åŒºåŸŸçš„å­—èŠ‚æ•°æ®çš„è§£è¯»æ–¹å¼</strong>ï¼Œåˆ†ä¸º <code>TypedArray</code> è§†å›¾ï¼ˆå°†æ‰€æœ‰æ•°ç»„æˆå‘˜éƒ½è§£è¯»ä¸º<strong>åŒä¸€ç§</strong>æ•°æ®ç±»å‹ï¼‰ã€<code>DataView</code> è§†å›¾ï¼ˆå°†æ‰€æœ‰æ•°ç»„æˆå‘˜éƒ½è§£è¯»ä¸º<strong>ä¸åŒçš„</strong>æ•°æ®ç±»å‹ï¼‰ã€‚</p>
</li>
<li>
<p>TypedArray è§†å›¾ï¼šå…±è®¡ 9 ç§ï¼Œå¯¹åº” 9 ç§<strong>æ„é€ å‡½æ•°</strong>ï¼Œ9 ç§æ•°ç»„æˆå‘˜çš„<strong>æ•°æ®ç±»å‹</strong>ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ„é€ å‡½æ•°</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Int8Array</td>
<td style="text-align:center">8 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Uint8Array</td>
<td style="text-align:center">8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚</td>
</tr>
<tr>
<td style="text-align:center">Uint8ClampedArray</td>
<td style="text-align:center">8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚ï¼Œæº¢å‡ºå¤„ç†ä¸åŒã€‚</td>
</tr>
<tr>
<td style="text-align:center">Int16Array</td>
<td style="text-align:center">16 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 2 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Uint16Array</td>
<td style="text-align:center">16 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 2 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Int32Array</td>
<td style="text-align:center">32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Uint32Array</td>
<td style="text-align:center">32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Float32Array</td>
<td style="text-align:center">32 ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Float64Array</td>
<td style="text-align:center">64 ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦ 8 ä¸ªå­—èŠ‚ã€‚</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>TypedArray Vs. Array</p>
<table>
<thead>
<tr>
<th style="text-align:center">å·®å¼‚ç‚¹</th>
<th style="text-align:center">TypedArray</th>
<th style="text-align:center">Array</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>æ•°ç»„æˆå‘˜ç±»å‹æ˜¯å¦ç›¸åŒ</strong></td>
<td style="text-align:center">æ˜¯</td>
<td style="text-align:center">å¦</td>
</tr>
<tr>
<td style="text-align:center"><strong>æ•°ç»„æˆå‘˜åœ¨å†…å­˜ç©ºé—´æ˜¯å¦è¿ç»­</strong></td>
<td style="text-align:center">æ˜¯</td>
<td style="text-align:center">ä¸ä¸€å®šï¼ˆå¯†é›†æ•°ç»„è¿ç»­ï¼Œç¨€ç–æ•°ç»„ä¸è¿ç»­ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"><strong>æ•°ç»„æˆå‘˜çš„é»˜è®¤å€¼</strong></td>
<td style="text-align:center">0</td>
<td style="text-align:center"><code>undefined</code>ï¼ˆç©ºä½ï¼‰</td>
</tr>
<tr>
<td style="text-align:center"><strong>æ•°æ®å­˜å‚¨ä½ç½®</strong></td>
<td style="text-align:center"><code>TypedArray</code> è§†å›¾å¯¹åº”çš„ <code>ArrayBuffer</code> å¯¹è±¡ï¼ˆå¯é€šè¿‡è§†å›¾çš„ <code>buffer</code> å±æ€§è·å–ï¼‰</td>
<td style="text-align:center"><code>Array</code> å¯¹è±¡è‡ªèº«</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h4 id="3-2-æ„é€ å‡½æ•°">3.2 æ„é€ å‡½æ•°</h4>
<blockquote>
<p>æ³¨ï¼šJavaScript <strong>å…è®¸åŸºäºåŒä¸€ <code>ArrayBuffer</code> å¯¹è±¡å»ºç«‹å¤šä¸ªè§†å›¾</strong>ï¼Œæ­¤æ—¶æ¯ä¸ªè§†å›¾å¯ä»¥æ ¹æ®è‡ªå·±çš„ç†è§£å»ä¿®æ”¹ç›¸åº”å†…å­˜åŒºåŸŸçš„æ•°æ®ï¼ŒåŒæ—¶ä¸€ä¸ªè§†å›¾å¯¹å†…å­˜çš„æ›´æ”¹ä¼šåœ¨å…¶ä»–è§†å›¾ä¸Šåæ˜ å‡ºæ¥ã€‚</p>
</blockquote>
<ol>
<li>
<p><code>TypedArray(buffer: ArrayBuffer, byteOffset: number=0[, length: number])</code> è¡¨ç¤ºä» <code>buffer</code> çš„ç¬¬ <code>byteOffset</code> ä¸ªå­—èŠ‚å¼€å§‹åˆ›å»ºè§†å›¾ï¼ŒåŒæ—¶ç¡®ä¿è§†å›¾çš„æˆå‘˜æ•°é‡ä¸º <code>length</code>ã€‚å…¶ä¸­ <code>byteOffset</code> æ˜¯ <code>0-based</code> è¡¨ç¤ºï¼Œè¡¨ç¤ºè§†å›¾å¼€å§‹çš„å­—èŠ‚åºå·ï¼Œé»˜è®¤å€¼ä¸º 0ï¼›<code>length</code> è¡¨ç¤ºè§†å›¾çš„æˆå‘˜æ•°é‡ï¼Œå› æ­¤è§†å›¾å¯¹åº”<strong>å†…å­˜åŒºåŸŸçš„é•¿åº¦ = <code>length</code> * æ¯ä¸ªæˆå‘˜å­—èŠ‚æ•°</strong>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>); <span class="comment">// å¯¹åº” 8 ä¸ªå­—èŠ‚çš„å†…å­˜åŒºåŸŸï¼ˆç¬¬ 0 ï½ 7 ä¸ªå­—èŠ‚ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> v1 = <span class="keyword">new</span> <span class="title class_">Int32Array</span>(buf); <span class="comment">// å¯æ“ä½œç¬¬ 0 ~ 7 ä¸ªå­—èŠ‚ï¼Œæ¯ 4 ä¸ªå­—èŠ‚è¢«è§£æä¸ºä¸€ä¸ª int32 ç±»å‹çš„æ•°ç»„æˆå‘˜ï¼Œå› æ­¤è§†å›¾æ•°ç»„é•¿åº¦ä¸º 2</span></span><br><span class="line"><span class="keyword">const</span> v2 = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buf, <span class="number">2</span>); <span class="comment">// å¯æ“ä½œç¬¬ 2 ~ 7 ä¸ªå­—èŠ‚ï¼Œæ¯ 1 ä¸ªå­—èŠ‚è¢«è§£æä¸ºä¸€ä¸ª uint8 ç±»å‹çš„æ•°ç»„æˆå‘˜ï¼Œå› æ­¤è§†å›¾æ•°ç»„é•¿åº¦ä¸º 6</span></span><br><span class="line"><span class="keyword">const</span> v3 = <span class="keyword">new</span> <span class="title class_">Int16Array</span>(buf, <span class="number">2</span>, <span class="number">2</span>); <span class="comment">// å¯æ“ä½œç¬¬ 2 ~ 5ï¼ˆ2 + 2 * 2 - 1ï¼‰ ä¸ªå­—èŠ‚ï¼Œæ¯ 2 ä¸ªå­—èŠ‚è¢«è§£æä¸ºä¸€ä¸ª int16 ç±»å‹çš„æ•°ç»„æˆå‘˜ï¼Œæ­¤æ—¶è§†å›¾æ•°ç»„é•¿åº¦è¢«æŒ‡å®šä¸º 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`v1.length=<span class="subst">$&#123;v1.length&#125;</span>, v2.length=<span class="subst">$&#123;v2.length&#125;</span>, v3.length=<span class="subst">$&#123;v3.length&#125;</span>`</span>); <span class="comment">// 2, 6, 2</span></span><br><span class="line">v1[<span class="number">0</span>] = <span class="number">0x12345678</span>; <span class="comment">// ä¿®æ”¹ç¬¬ 0 ï½ 3 ä¸ªå­—èŠ‚çš„å€¼ä¸º 0x12345678ï¼Œæ­¤æ—¶ v2[0] è¡¨ç¤ºç¬¬ 2 ä¸ªå­—èŠ‚çš„å€¼ä¸º 0x34, è¡¨ç¤ºç¬¬ 2 ï½ 3 ä¸ªå­—èŠ‚çš„å€¼ä¸º 0x1234</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf); <span class="comment">// [Uint8Contents]: &lt;78 56 34 12 00 00 00 00&gt;ï¼ˆArrayBuffer åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ¯ä¸ªå­—èŠ‚çš„å€¼ï¼‰</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`v1[0]=0x<span class="subst">$&#123;v1[<span class="number">0</span>].toString(<span class="number">16</span>)&#125;</span>, v2[0]=0x<span class="subst">$&#123;v2[<span class="number">0</span>].toString(<span class="number">16</span>)&#125;</span>, v3[0]=0x<span class="subst">$&#123;v3[<span class="number">0</span>].toString(<span class="number">16</span>)&#125;</span>`</span>); <span class="comment">// 0x12345678, 0x34, 0x1234</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šåˆ›å»ºè§†å›¾æ—¶ï¼ŒbyteOffset å¿…é¡»ä¸æ‰€å»ºç«‹çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå³ byteOffset å¿…é¡»æ˜¯æ•°ç»„æˆå‘˜çš„å­—èŠ‚æ•°çš„æ•´æ•°å€ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> v4 = <span class="keyword">new</span> <span class="title class_">Int16Array</span>(buf, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">// RangeError: start offset of Int16Array should be a multiple of 2</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li>
<p><code>TypedArray(length)</code> è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªæˆå‘˜æ•°é‡ä¸º <code>length</code> çš„è§†å›¾ï¼Œæ­¤æ—¶è§†å›¾å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º <strong><code>length</code> * è§†å›¾æˆå‘˜å­—èŠ‚æ•°</strong> çš„ <code>ArrayBuffer</code>ã€‚å…¶ä¸­ <code>length</code> è¡¨ç¤ºè§†å›¾æˆå‘˜æ•°é‡ï¼›è§†å›¾åˆ›å»ºçš„ <code>ArrayBuffer</code> å¯ä»¥é€šè¿‡è§†å›¾çš„ <code>buffer</code> å±æ€§è·å–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f64a = <span class="keyword">new</span> <span class="title class_">Float64Array</span>(<span class="number">8</span>); <span class="comment">// è§†å›¾æˆå‘˜æ•°é‡ä¸º 8ï¼Œå¯¹åº”çš„å†…å­˜åŒºåŸŸå¤§å°ä¸º 8 * 8 = 64 å­—èŠ‚</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`f64a.length=<span class="subst">$&#123;f64a.length&#125;</span>, f64a.buffer.byteLength=<span class="subst">$&#123;f64a.buffer.byteLength&#125;</span>`</span>); <span class="comment">// 8, 64</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f64a.<span class="property">buffer</span>); <span class="comment">// [Uint8Contents]: &lt;00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00&gt;ï¼ˆArrayBuffer åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ¯ä¸ªå­—èŠ‚çš„å€¼ï¼‰</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>TypedArray(typedArray)</code> è¡¨ç¤ºåŸºäºç»™å®šè§†å›¾åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾ï¼Œæ­¤æ—¶æ–°è§†å›¾å¯¹åº”çš„ <code>ArrayBuffer</code> ä¸ç»™å®šè§†å›¾çš„ <code>ArrayBuffer</code> ä¸æ˜¯åŒä¸€ä¸ªï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤ä¸ª <code>ArrayBuffer</code> å†…å­˜åŒºåŸŸä¸åŒï¼Œä½†æ˜¯æ•°æ®ç›¸åŒï¼Œå³æ•°æ®å‘ç”Ÿäº†æ‹·è´ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> view1 = <span class="keyword">new</span> <span class="title class_">Int16Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> view2 = <span class="keyword">new</span> <span class="title class_">Int16Array</span>(view1);</span><br><span class="line">view1[<span class="number">0</span>] = <span class="number">123</span>; <span class="comment">// æ­¤æ—¶ view1 å¯¹åº”çš„å†…å­˜åŒºåŸŸæ•°æ®ä¸º 123 2 3 4ï¼Œview2 å¯¹åº”çš„å†…å­˜åŒºåŸŸçš„æ•°æ®ä¸º 1 2 3 4ï¼Œå³ä¸¤ä¸ªè§†å›¾çš„å†…å­˜åŒºåŸŸç›¸äº’ç‹¬ç«‹äº’ä¸å¹²æ‰°</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`view1[0]=<span class="subst">$&#123;view1[<span class="number">0</span>]&#125;</span>, view2[0]=<span class="subst">$&#123;view2[<span class="number">0</span>]&#125;</span>`</span>); <span class="comment">// 123, 1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>TypedArray(arrayLikeObject)</code> è¡¨ç¤ºåŸºäºç»™å®šç±»æ•°ç»„å¯¹è±¡åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œæ­¤æ—¶è§†å›¾å®é™…ä¸Šå¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„ <code>ArrayBuffer</code>ï¼Œä¸ç»™å®šç±»æ•°ç»„å¯¹è±¡æ— å…³ï¼Œå³æ•°æ®å‘ç”Ÿäº†æ‹·è´ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> view = <span class="keyword">new</span> <span class="title class_">Int16Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// è§†å›¾çš„æˆå‘˜æ•°é‡ä¸ºç»™å®šçš„ç±»æ•°ç»„å¯¹è±¡çš„æˆå‘˜æ•°é‡ã€‚</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`view.length=<span class="subst">$&#123;view.length&#125;</span>`</span>); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šTypedArray è§†å›¾å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹æ³•è½¬æ¢ä¸ºæ™®é€šæ•°ç»„ï¼š<code>[...typedArray]</code>, <code>Array.from(typedArray)</code>, <code>Array.prototype.slice.call(typedArray)</code>ã€‚</p>
</blockquote>
</li>
</ol>
<h4 id="3-3-æ•°ç»„æ–¹æ³•">3.3 æ•°ç»„æ–¹æ³•</h4>
<ol>
<li>
<p>TypedArray å¯ç”¨çš„æ•°ç»„æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">copyWithin</span>(target, start[, end=<span class="variable language_">this</span>.<span class="property">length</span>])</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">entries</span>()</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">every</span>(callbackfn, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">fill</span>(value, start=<span class="number">0</span>, end=<span class="variable language_">this</span>.<span class="property">length</span>)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">filter</span>(callbackfn, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">find</span>(predicate, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">findIndex</span>(predicate, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">forEach</span>(callbackfn, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">indexOf</span>(searchElement, fromIndex=<span class="number">0</span>)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">join</span>(separator)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">keys</span>()</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">lastIndexOf</span>(searchElement, fromIndex?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">map</span>(callbackfn, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">reduce</span>(callbackfn, initialValue?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">reduceRight</span>(callbackfn, initialValue?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">reverse</span>()</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">slice</span>(start=<span class="number">0</span>, end=<span class="variable language_">this</span>.<span class="property">length</span>)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">some</span>(callbackfn, thisArg?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">sort</span>(comparefn)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">toLocaleString</span>(reserved1?, reserved2?)</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">toString</span>()</span><br><span class="line"><span class="title class_">TypedArray</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">values</span>()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨è¯´æ˜</p>
<ul>
<li>
<p><code>TypedArray</code> æ•°ç»„æ²¡æœ‰ <code>concat</code> æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°å®ç°å¤šä¸ª <code>TypedArray</code> æ•°ç»„çš„<strong>åˆå¹¶</strong>æ“ä½œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">concatenate</span>(<span class="params">resultConstructor, ...arrays</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> totalLength = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> arr <span class="keyword">of</span> arrays) &#123;</span><br><span class="line">    totalLength += arr.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">new</span> <span class="title function_">resultConstructor</span>(totalLength);</span><br><span class="line">  <span class="keyword">let</span> offset = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> arr <span class="keyword">of</span> arrays) &#123;</span><br><span class="line">    result.<span class="title function_">set</span>(arr, offset);</span><br><span class="line">    offset += arr.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">concatenate</span>(<span class="title class_">Uint8Array</span>, <span class="title class_">Uint8Array</span>.<span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="title class_">Uint8Array</span>.<span class="title function_">of</span>(<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼š<code>TypedArray</code> å¯ä»¥ç§°ä¹‹ä¸º<strong>æ•°ç»„</strong>ï¼Œå› ä¸ºå…¶å®ç°äº†æ•°ç»„æ¥å£ï¼›ä¹Ÿå¯ç§°ä¹‹ä¸º<strong>è§†å›¾</strong>ï¼Œå› ä¸ºå…¶å¯ä»¥å¯¹ <code>ArrayBuffer</code> å¯¹åº”çš„å†…å­˜åŒºåŸŸè¿›è¡Œæ“ä½œã€‚</p>
</blockquote>
</li>
<li>
<p><code>TypedArray</code> æ•°ç»„éƒ¨ç½²äº† <code>Iterator</code> æ¥å£ï¼Œå³ <code>TypedArray</code> æ•°ç»„æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ <code>for...of</code> éå†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ui8 = <span class="title class_">Uint8Array</span>.<span class="title function_">of</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> byte <span class="keyword">of</span> ui8) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(byte);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="3-4-å­—èŠ‚åº">3.4 å­—èŠ‚åº</h4>
<ol>
<li>
<p><strong>å¤§ç«¯å­—èŠ‚åº</strong>ï¼ˆBig-Endianï¼‰ï¼šé‡è¦çš„å­—èŠ‚æ’åœ¨å‰è¾¹ï¼Œä¸é‡è¦çš„å­—èŠ‚æ’åœ¨åè¾¹ã€‚æ¢å¥è¯è¯´ï¼Œé«˜ä½å­—èŠ‚æ’åœ¨å†…å­˜ä½ä½ï¼Œä½ä½å­—èŠ‚æ’åœ¨å†…å­˜é«˜ä½ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<code>0x12345678</code> çš„å¤§ç«¯å­—èŠ‚åºçš„å­˜å‚¨ä¸º <code>12</code> <code>34</code> <code>56</code> <code>78</code>ï¼ˆå†…å­˜åœ°å€ä»ä½åˆ°é«˜ï¼‰ã€‚</li>
<li>åœºæ™¯ï¼šç½‘ç»œä¼ è¾“ï¼ˆTCP/IP åè®®ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>å°ç«¯å­—èŠ‚åº</strong>ï¼ˆLittle-Endianï¼Œé»˜è®¤ï¼‰ï¼šä¸é‡è¦çš„å­—èŠ‚æ’åœ¨å‰è¾¹ï¼Œé‡è¦çš„å­—èŠ‚æ’åœ¨åè¾¹ã€‚æ¢å¥è¯è¯´ï¼Œä½ä½å­—èŠ‚åœ¨å†…å­˜ä½ä½ï¼Œé«˜ä½å­—èŠ‚åœ¨å†…å­˜é«˜ä½ã€‚</p>
<blockquote>
<p>æ³¨ï¼š<code>TypedArray</code> è§†å›¾é‡‡å–<strong>å°ç«¯å­—èŠ‚åº</strong>è¯»å†™æ•°æ®ï¼Œä¸æ”¯æŒä¿®æ”¹å­—èŠ‚åºã€‚ä½†æ˜¯ï¼Œ<code>DataView</code> è§†å›¾æ”¯æŒä»¥æŒ‡å®šçš„å­—èŠ‚åºè¯»å†™æ•°æ®ã€‚</p>
</blockquote>
<ul>
<li>ç¤ºä¾‹ï¼š<code>0x12345678</code> çš„å°ç«¯å­—èŠ‚åºçš„å­˜å‚¨ä¸º <code>78</code> <code>56</code> <code>34</code> <code>12</code>ï¼ˆå†…å­˜åœ°å€ä»ä½åˆ°é«˜ï¼‰ã€‚</li>
<li>åœºæ™¯ï¼šx86 å¤„ç†å™¨ã€Windows ç³»ç»Ÿã€‚</li>
</ul>
</li>
<li>
<p>å­—èŠ‚åºåˆ¤æ–­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">BIG_ENDIAN</span> = <span class="title class_">Symbol</span>(<span class="string">&#x27;BIG_ENDIAN&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LITTLE_ENDIAN</span> = <span class="title class_">Symbol</span>(<span class="string">&#x27;LITTLE_ENDIAN&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPlatformEndianness</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arr32 = <span class="title class_">Uint32Array</span>.<span class="title function_">of</span>(<span class="number">0x12345678</span>);</span><br><span class="line">  <span class="keyword">let</span> arr8 = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(arr32.<span class="property">buffer</span>);</span><br><span class="line">  <span class="keyword">switch</span> ((arr8[<span class="number">0</span>]*<span class="number">0x1000000</span>) + (arr8[<span class="number">1</span>]*<span class="number">0x10000</span>) + (arr8[<span class="number">2</span>]*<span class="number">0x100</span>) + (arr8[<span class="number">3</span>])) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x12345678</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="variable constant_">BIG_ENDIAN</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x78563412</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="variable constant_">LITTLE_ENDIAN</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknown endianness&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="3-5-å±æ€§å’Œæ–¹æ³•">3.5 å±æ€§å’Œæ–¹æ³•</h4>
<ol>
<li>
<p>é™æ€å±æ€§</p>
<ul>
<li>
<p><code>TypedArray.BYTES_PER_ELEMENT</code> è·å–æŒ‡å®šè§†å›¾çš„æ•°ç»„æˆå‘˜æ‰€å æ®çš„å­—èŠ‚æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Int8Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 1</span></span><br><span class="line"><span class="title class_">Uint8Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 1</span></span><br><span class="line"><span class="title class_">Uint8ClampedArray</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 1</span></span><br><span class="line"><span class="title class_">Int16Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 2</span></span><br><span class="line"><span class="title class_">Uint16Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 2</span></span><br><span class="line"><span class="title class_">Int32Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 4</span></span><br><span class="line"><span class="title class_">Uint32Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 4</span></span><br><span class="line"><span class="title class_">Float32Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 4</span></span><br><span class="line"><span class="title class_">Float64Array</span>.<span class="property">BYTES_PER_ELEMENT</span> <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å®ä¾‹å±æ€§</p>
<ul>
<li><code>TypedArray.prototype.BYTES_PER_ELEMENT</code> ä¸ <code>TypedArray.BYTES_PER_ELEMENT</code> ç›¸åŒã€‚</li>
</ul>
</li>
</ol>
<h3 id="4-DataView">4. DataView</h3>
<p>More in <a target="_blank" rel="noopener" href="https://netmarket.oss.aliyuncs.com/35cdb5c1-9e70-4562-a245-2664416d784b.pdf">é˜®ä¸€å³° ES6ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</a></p>
<details class="toggle" ><summary class="toggle-button" style="">æœ¬è´´å‚è€ƒ</summary><div class="toggle-content"><p><a target="_blank" rel="noopener" href="https://netmarket.oss.aliyuncs.com/35cdb5c1-9e70-4562-a245-2664416d784b.pdf">é˜®ä¸€å³° ES6ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</a></p>
</div></details>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Nasir1423">yiTuChuan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://zhengzehua.top/2025/02/08/ES6%E6%95%99%E7%A8%8B@%E9%98%AE%E4%B8%80%E5%B3%B0/">https://zhengzehua.top/2025/02/08/ES6%E6%95%99%E7%A8%8B@%E9%98%AE%E4%B8%80%E5%B3%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://zhengzehua.top" target="_blank">å·ä¸€åœŸçš„åšå®¢è§†ç•Œ</a>ï¼</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/images/butterfly_avatar_img.svg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/01/14/Git/" title="ğŸ“–Git"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ğŸ“–Git</div></div><div class="info-2"><div class="info-item-1">ç³»ç»Ÿä»‹ç» Git çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤ï¼ŒåŒ…æ‹¬é…ç½®ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€åˆ†æ”¯æ“ä½œã€è¿œç¨‹åä½œã€æ ‡ç­¾ç®¡ç†ç­‰å†…å®¹ã€‚é€šè¿‡è¯¦ç»†çš„å‘½ä»¤è¯´æ˜å’Œå›¾æ–‡å¹¶èŒ‚çš„åŸç†è§£é‡Šï¼Œå¸®åŠ©è¯»è€…æŒæ¡ Git åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ï¼Œå»ºç«‹èµ·å®Œæ•´çš„ Git çŸ¥è¯†ä½“ç³»ã€‚</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-Map"><span class="toc-text">Set &amp; Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Set"><span class="toc-text">1. Set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-WeakSet"><span class="toc-text">2. WeakSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Map"><span class="toc-text">3. Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-WeakMap"><span class="toc-text">4. WeakMap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Symbol"><span class="toc-text">Symbol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reflect"><span class="toc-text">Reflect</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0"><span class="toc-text">1. ç®€è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-text">2. é™æ€æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BA%94%E7%94%A8%EF%BC%9A%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">3. åº”ç”¨ï¼šè§‚å¯Ÿè€…æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy"><span class="toc-text">Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0-2"><span class="toc-text">1. ç®€è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8B%A6%E6%88%AA%E6%93%8D%E4%BD%9C"><span class="toc-text">2. æ‹¦æˆªæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%AF%E5%8F%96%E6%B6%88%E7%9A%84-Proxy"><span class="toc-text">3. å¯å–æ¶ˆçš„ Proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-this-%E9%97%AE%E9%A2%98"><span class="toc-text">4. this é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E6%A3%80%E6%B5%8B%E6%80%BB%E7%BB%93"><span class="toc-text">5. å¯¹è±¡å±æ€§æ£€æµ‹æ€»ç»“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%BA%94%E7%94%A8%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93-ORM"><span class="toc-text">6. åº”ç”¨ï¼šæ•°æ®åº“ ORM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iterator"><span class="toc-text">Iterator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0-3"><span class="toc-text">1. ç®€è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Iterator-%E6%8E%A5%E5%8F%A3"><span class="toc-text">2. Iterator æ¥å£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Symbol-iterator"><span class="toc-text">2.1 Symbol.iterator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%8E%A5%E5%8F%A3%E9%83%A8%E7%BD%B2"><span class="toc-text">2.2 æ¥å£éƒ¨ç½²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E8%B0%83%E7%94%A8%E5%9C%BA%E5%90%88"><span class="toc-text">2.3 è°ƒç”¨åœºåˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%87%A0%E4%B8%AA%E6%A6%82%E5%BF%B5"><span class="toc-text">2.4 å‡ ä¸ªæ¦‚å¿µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Iterator-%E7%BB%93%E6%9E%84"><span class="toc-text">3. Iterator ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">4. ç”Ÿæˆæ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%81%8D%E5%8E%86%E8%AF%AD%E6%B3%95%E6%AF%94%E8%BE%83"><span class="toc-text">5. éå†è¯­æ³•æ¯”è¾ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generator-%E5%87%BD%E6%95%B0"><span class="toc-text">Generator å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0-4"><span class="toc-text">1. ç®€è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-next-%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text">2. next æ–¹æ³•çš„å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Generator-%E5%87%BD%E6%95%B0%E7%9A%84%E5%8E%9F%E5%9E%8B%E6%96%B9%E6%B3%95"><span class="toc-text">3. Generator å‡½æ•°çš„åŸå‹æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Generator-prototype-throw"><span class="toc-text">3.1 Generator.prototype.throw()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Generator-prototype-return"><span class="toc-text">3.2 Generator.prototype.return()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-next-%E3%80%81throw-%E3%80%81return-%E5%AF%B9%E6%AF%94"><span class="toc-text">3.3 next()ã€throw()ã€return() å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-yield-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">4. yield* è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Generator-%E4%B8%8E%E5%8D%8F%E7%A8%8B"><span class="toc-text">5. Generator ä¸åç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArrayBuffer"><span class="toc-text">ArrayBuffer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0-5"><span class="toc-text">1. ç®€è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ArrayBuffer"><span class="toc-text">2. ArrayBuffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-TypedArray"><span class="toc-text">3. TypedArray</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3"><span class="toc-text">3.1 æ¦‚å¿µç†è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">3.2 æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95"><span class="toc-text">3.3 æ•°ç»„æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-text">3.4 å­—èŠ‚åº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-text">3.5 å±æ€§å’Œæ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-DataView"><span class="toc-text">4. DataView</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2024 - 2025 By yiTuChuan</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.4.0-b2"></script><script src="/js/main.js?v=5.4.0-b2"></script><div class="js-pjax"><script>(() = {
  const abcjsInit = () => {
    const abcjsFn = () => {
      setTimeout(() => {
        const sheets = document.querySelectorAll(".abc-music-sheet")
        for (let i = 0; i < sheets.length; i++) {
          const ele = sheets[i]
          if (ele.children.length > 0) continue

          // Parse parameters from data-params attribute
          let params = {}
          const dp = ele.getAttribute("data-params")
          if (dp) {
            try {
              params = JSON.parse(dp)
            } catch (e) {
              console.error("Failed to parse data-params:", e)
            }
          }

          // Merge parsed parameters with the responsive option
          // Ensures params content appears before responsive
          const options = { ...params, responsive: "resize" }

          // Render the music score using ABCJS.renderAbc
          ABCJS.renderAbc(ele, ele.innerHTML, options)
        }
      }, 100)
    }

    if (typeof ABCJS === "object") {
      abcjsFn()
    } else {
      btf.getScript("https://cdn.jsdelivr.net/npm/abcjs@6.4.4/dist/abcjs-basic-min.min.js").then(abcjsFn)
    }
  }

  if (window.pjax) {
    abcjsInit()
  } else {
    window.addEventListener("load", abcjsInit)
  }

  btf.addGlobalFn("encrypt", abcjsInit, "abcjs")
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'Nasir1423/blog-comment',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/click-show-text.min.js" data-mobile="false" data-text="Prosperity,Democracy,Civility,Harmony,Freedom,Equality,Justice,Rule of Law,Patriotism,Dedication,Integrity,Friendliness" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>